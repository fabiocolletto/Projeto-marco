<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Assistente Cerimonial – Lista e PDF</title>
<style>
  :root{ --line:#e5e7eb; --muted:#64748b; }
  #app{ max-width:1100px; margin:0 auto; padding:12px; }
  .field{ border:1px solid var(--line); border-radius:8px; padding:8px; background:#fff; }
  .field > label{ display:block; font-weight:600; margin-bottom:4px; }
  input,textarea,select{ width:100%; }
  .grid-2{ display:grid; gap:12px; }
  @media (min-width: 900px){ .grid-2{ grid-template-columns: 1fr 1fr; } }
  .row{ display:flex; align-items:center; gap:10px; flex-wrap:wrap; }
  .muted{ color:var(--muted); }
  .summary-grid{ display:grid; gap:12px; margin-bottom:10px; }
  @media (min-width: 600px){ .summary-grid{ grid-template-columns: repeat(2,1fr); } }
  @media (min-width: 1000px){ .summary-grid{ grid-template-columns: repeat(3,1fr); } }
  .totals-grid{ display:flex; gap:12px; align-items:stretch; }
  .totals-card{ flex:1; border:1px solid var(--line); border-radius:8px; padding:8px; background:#fff; }
  .totals-list{ display:grid; grid-template-columns: 1fr auto; gap:6px 8px; align-items:center; }
  .totals-item .label{ color:var(--muted); }
  .meter{ height:8px; background:#f1f5f9; border-radius:999px; overflow:hidden; grid-column:1/-1; }
  .meter span{ display:block; height:100%; width:0; }
  .bar-nao{ background:#cbd5e1; } .bar-env{ background:#fdba74; } .bar-resp{ background:#34d399; }
  .bar-gconf{ background:#34d399; } .bar-gpend{ background:#fbbf24; } .bar-gnao{ background:#94a3b8; }
  @media (max-width: 800px){ .totals-grid{ flex-direction:column; } }
  .table-wrap{ overflow:auto; border:1px solid var(--line); border-radius:8px; }
  table{ width:100%; border-collapse:separate; border-spacing:0; }
  th,td{ padding:8px; border-bottom:1px solid var(--line); text-align:left; }
  .icon-btn{ border:1px solid var(--line); background:#f8fafc; border-radius:6px; padding:4px 8px; cursor:pointer; }
  .badge-intl{ margin-left:6px; font-size:11px; border:1px solid var(--line); border-radius:999px; padding:0 6px; }
  .badge-status{ display:inline-block; padding:2px 6px; border:1px solid var(--line); border-radius:999px; font-size:12px; }
  .badge-status.s-nao{ color:#64748b; } .badge-status.s-env{ color:#b45309; } .badge-status.s-resp{ color:#047857; }
  .status-ico{ margin-right:6px; }
  .fill-line{ display:inline-block; border-bottom:1px solid var(--line); min-width:40px; }
  .footer-actions{ display:flex; gap:8px; flex-wrap:wrap; align-items:center; margin-top:12px; }
  .confirmados-print{ display:none; }
  @media print{ .footer-actions, .row button, .import-wrap{ display:none!important; } .confirmados-print{ display:inline!important; } .field{ border:0; } }
</style>
</head>
<body>
<div id="app">
  <header>
    <div class="title">5 Horas P&A — Lista de Convidados</div>
    <div class="meta">
      <div>Revisão: <span id="rev-tag" contenteditable>2.1.1</span></div>
      <div>Doc: <span id="doc-id" contenteditable>0011</span></div>
    </div>
  </header>

  <section aria-label="Dados do evento">
    <h2>Evento</h2>
    <div class="grid-2">
      <div class="field"><label for="ev-name">Nome do evento</label><input id="ev-name" type="text"></div>
      <div class="field"><label for="ev-dt">Data e horário</label><input id="ev-dt" type="datetime-local"></div>
      <div class="field"><label for="ev-venue">Espaço/Local</label><input id="ev-venue" type="text"></div>
      <div class="field"><label for="ev-address">Endereço</label><input id="ev-address" type="text"></div>
      <div class="field"><label for="ev-ref">Ponto de referência</label><input id="ev-ref" type="text"></div>
      <div class="field"><label for="ev-type">Tipo do evento</label><input id="ev-type" type="text"></div>
      <div class="field"><label for="ev-dress">Traje</label><input id="ev-dress" type="text"></div>
      <div class="field"><label for="ev-org">Organizador</label><input id="ev-org" type="text"></div>
    </div>
  </section>

  <section aria-label="Convidados">
    <h2>Convidados</h2>
    <div class="field">
      <label for="cv-raw">Lista de convites</label>
      <textarea id="cv-raw" rows="6"></textarea>
    </div>
    <div class="row">
      <button id="cv-add" type="button">Adicionar à lista</button>
      <span class="muted" id="cv-feedback"></span>
    </div>
  </section>

  <section class="summary export" aria-label="Resumo e indicadores">
    <h2>Resumo</h2>
    <div class="summary-grid">
      <div><p><strong>Nome:</strong> <span id="s-name"></span></p><p><strong>Data:</strong> <span id="s-date"></span></p><p><strong>Horário:</strong> <span id="s-time"></span></p></div>
      <div><p><strong>Espaço:</strong> <span id="s-venue"></span></p><p><strong>Endereço:</strong> <span id="s-address"></span></p><p><strong>Referência:</strong> <span id="s-ref"></span></p></div>
      <div><p><strong>Tipo:</strong> <span id="s-type"></span></p><p><strong>Traje:</strong> <span id="s-dress"></span></p><p><strong>Organizador:</strong> <span id="s-org"></span></p></div>
    </div>

    <h2>Indicadores</h2>
    <div id="report-totals" class="totals-grid">
      <div class="totals-card"><h3>Totais</h3>
        <div class="totals-list">
          <div><span id="t-convites">0</span></div>
          <div><span id="t-convidados">0</span></div>
          <div><span id="t-confirmados">0</span></div>
        </div>
      </div>
    </div>
  </section>

  <section class="export export-list" aria-label="Lista para exportação">
    <h2>Lista de convidados</h2>
    <div id="cv-list" class="field"></div>
  </section>

  <div class="footer-actions">
    <button id="btn-clear" type="button">Limpar lista</button>
    <button id="btn-pdf" type="button">Gerar PDF</button>
  </div>
</div>

<!-- Biblioteca de funções externas -->
<script src="https://cdn.jsdelivr.net/gh/fabiocolletto/Projeto-marco@v2.1.0/utils/cerimonial-utils.js"></script>

<!-- Script principal -->
<script>
(()=>{
  const {
    titleCase, padronizaBR, normalizeIntlE164, isLikelyPhone,
    extractPhoneName, validateInvite, parseLines,
    sumGuests, sumConfirmed, sumGuestsWhere,
    statusLabel, statusClass, calcInvitePercents, calcGuestPercents
  } = window.CerimonialUtils;

  const $=(sel, root=document)=> root.querySelector(sel);
  const state={invites:[],seq:1};

  const cvRaw=$('#cv-raw'), cvList=$('#cv-list'), cvAdd=$('#cv-add'), cvFeedback=$('#cv-feedback');
  const tConvites=$('#t-convites'), tConvidados=$('#t-convidados'), tConfirmados=$('#t-confirmados');

  function renderTable(){
    if(state.invites.length===0){
      cvList.innerHTML='<p class="muted">Nenhum convite adicionado ainda.</p>';
      return;
    }
    let rows='';
    state.invites.forEach((it,i)=>{
      rows+= `<div>${i+1}. ${it.name} (${it.phone||'sem tel'})</div>`;
    });
    cvList.innerHTML=rows;
  }

  if(cvAdd){
    cvAdd.addEventListener('click',()=>{
      const res=parseLines(cvRaw.value);
      if(res.items.length){
        res.items.forEach(it=>{ it.id=state.seq++; validateInvite(it); });
        state.invites=state.invites.concat(res.items);
        renderTable();
        tConvites.textContent=state.invites.length;
        tConvidados.textContent=sumGuests(state.invites);
        tConfirmados.textContent=sumConfirmed(state.invites);
        cvFeedback.textContent=`${res.items.length} convite(s) adicionados.`;
        cvRaw.value='';
      } else {
        cvFeedback.textContent='Nada para adicionar.';
      }
    });
  }

  if($('#btn-clear')){
    $('#btn-clear').addEventListener('click',()=>{
      state.invites=[]; renderTable();
      tConvites.textContent=0; tConvidados.textContent=0; tConfirmados.textContent=0;
    });
  }

  if($('#btn-pdf')){
    $('#btn-pdf').addEventListener('click',()=> window.print());
  }
})();
</script>
</body>
</html>
