<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Marco Â· AppBase + MiniApps</title>
    <style>
      :root {
        --bg-primary: #f6f8fc;
        --bg-secondary: #e8edfa;
        --bg-tertiary: #dfe4f6;
        --surface: rgba(255, 255, 255, 0.92);
        --surface-strong: rgba(255, 255, 255, 0.98);
        --accent: #4f6ef7;
        --accent-strong: #1d4ed8;
        --lavender: #7c3aed;
        --success: #22c55e;
        --success-soft: rgba(34, 197, 94, 0.12);
        --warning: #f59e0b;
        --warning-soft: rgba(245, 158, 11, 0.16);
        --danger: #ef4444;
        --danger-soft: rgba(239, 68, 68, 0.12);
        --text-primary: #1f2a44;
        --text-secondary: #5f6c8a;
        --border-color: rgba(187, 195, 216, 0.6);
        --border-strong: rgba(99, 102, 241, 0.28);
        --shadow-elevated: none;
        --radius-large: 0;
        --radius-medium: 0;
        --radius-small: 0;
        --space-2xs: 6px;
        --space-xs: 10px;
        --space-sm: 14px;
        --space-md: 18px;
        --space-lg: 24px;
        --space-xl: 32px;
        --space-xxl: 48px;
        --layout-gutter: clamp(24px, 5vw, 60px);
        --layout-gap: clamp(20px, 3vw, 28px);
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        min-height: 100vh;
        font-family: "Inter", "SF Pro Display", -apple-system, system-ui, sans-serif;
        background: linear-gradient(180deg, var(--bg-primary) 0%, var(--bg-tertiary) 100%);
        color: var(--text-primary);
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      header.app-header,
      main,
      footer {
        width: min(1180px, calc(100% - (var(--layout-gutter) * 2)));
        margin: 0 auto;
      }

      a,
      button {
        font-family: inherit;
        color: inherit;
      }

      .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
      }

      header.app-header {
        margin-top: var(--space-xl);
        padding: var(--space-lg) var(--layout-gutter);
        display: flex;
        flex-wrap: wrap;
        gap: var(--layout-gap);
        align-items: center;
        justify-content: space-between;
        background: var(--surface);
        border: 1px solid var(--border-color);
        border-radius: 0;
        box-shadow: none;
      }

      .logo-area {
        display: flex;
        align-items: center;
        gap: 20px;
      }

      .app-badge {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 64px;
        height: 64px;
        border-radius: 18px;
        background: linear-gradient(135deg, var(--accent-strong), var(--lavender));
        font-weight: 700;
        font-size: 1rem;
        letter-spacing: 0.08em;
        text-transform: uppercase;
      }

      .title-group h1 {
        margin: 0;
        font-size: clamp(1.8rem, 3vw, 2.6rem);
      }

      .title-group p {
        margin: 6px 0 0;
        color: var(--text-secondary);
        max-width: 560px;
        font-size: 0.95rem;
      }

      .status-area {
        display: flex;
        flex-direction: column;
        gap: 12px;
        align-items: flex-end;
      }

      .status-indicator {
        padding: 10px 20px;
        border-radius: 999px;
        font-weight: 600;
        font-size: 0.85rem;
        display: inline-flex;
        align-items: center;
        gap: 10px;
        background: var(--success-soft);
        color: var(--success);
        border: 1px solid rgba(34, 197, 94, 0.3);
      }

      .status-indicator::before {
        content: "";
        display: inline-block;
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background: currentColor;
        box-shadow: 0 0 10px rgba(34, 197, 94, 0.3);
      }

      .status-meta {
        color: var(--text-secondary);
        font-size: 0.85rem;
        display: flex;
        flex-direction: column;
        gap: 6px;
        text-align: right;
      }

      main {
        flex: 1;
        padding: var(--space-xl) 0 calc(var(--space-xl) + var(--space-xxl));
        width: 100%;
      }

      .view {
        display: none;
      }

      .view.active {
        display: block;
        animation: fadeIn 220ms ease-out;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(8px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .main-layout {
        margin-top: var(--space-lg);
        display: grid;
        grid-template-columns: repeat(2, minmax(0, 1fr));
        grid-auto-rows: minmax(260px, auto);
        width: 100%;
        border: 1px solid var(--border-color);
        border-radius: 0;
        overflow: hidden;
        gap: 0;
      }

      .main-layout > .app-block {
        padding: var(--space-lg);
        display: flex;
        flex-direction: column;
        gap: var(--space-md);
        background: var(--surface-strong);
        border-left: 1px solid var(--border-color);
        border-top: 1px solid var(--border-color);
      }

      .main-layout > .app-block:nth-child(1),
      .main-layout > .app-block:nth-child(2) {
        border-top: none;
      }

      .main-layout > .app-block:nth-child(1),
      .main-layout > .app-block:nth-child(3) {
        border-left: none;
      }

      .main-layout .card {
        border: none;
        border-radius: 0;
        box-shadow: none;
        padding: 0;
        background: transparent;
      }

      .app-metrics-grid,
      .app-metrics-highlights {
        display: grid;
        gap: var(--space-sm);
        grid-template-columns: repeat(3, minmax(0, 1fr));
      }

      .app-metric,
      .app-highlight {
        display: flex;
        flex-direction: column;
        gap: 6px;
      }

      .app-metric span,
      .app-highlight span {
        font-size: 0.75rem;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        color: var(--text-secondary);
      }

      .app-metric strong,
      .app-highlight strong {
        font-size: clamp(1.4rem, 2.4vw, 1.8rem);
        color: var(--text-primary);
      }

      @media (max-width: 960px) {
        .main-layout {
          grid-template-columns: 1fr;
        }

        .main-layout > .app-block {
          border-left: none;
        }

        .main-layout > .app-block:nth-child(2) {
          border-top: 1px solid var(--border-color);
        }
      }

      @media (max-width: 720px) {
        .app-metrics-grid,
        .app-metrics-highlights {
          grid-template-columns: repeat(2, minmax(0, 1fr));
        }
      }

      @media (max-width: 520px) {
        .app-metrics-grid,
        .app-metrics-highlights {
          grid-template-columns: 1fr;
        }
      }

      .miniapp-list header {
        display: flex;
        flex-direction: column;
        gap: 6px;
      }

      .miniapp-list header h3 {
        margin: 0;
        font-size: 1rem;
      }

      .miniapp-list header p {
        margin: 0;
        font-size: 0.8rem;
        color: var(--text-secondary);
      }

      .miniapp-list header span {
        font-weight: 600;
        color: var(--accent-strong);
      }

      .miniapp-rail {
        margin-top: var(--space-md);
        display: grid;
        gap: var(--space-sm);
      }

      .mini-app-card {
        border-radius: var(--radius-medium);
        border: 1px solid rgba(79, 110, 247, 0.32);
        background: rgba(79, 110, 247, 0.12);
        padding: var(--space-sm) var(--space-md);
        display: grid;
        gap: var(--space-xs);
        cursor: pointer;
        transition: transform 120ms ease, box-shadow 120ms ease, border 120ms ease;
      }

      .mini-app-card:hover {
        transform: translateY(-1px);
        box-shadow: 0 18px 32px rgba(79, 110, 247, 0.18);
        border-color: rgba(79, 110, 247, 0.48);
      }

      .mini-app-card:focus-visible {
        outline: 2px solid rgba(79, 110, 247, 0.8);
        outline-offset: 3px;
      }

      .mini-app-card-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: var(--space-xs);
      }

      .mini-app-chip {
        display: inline-flex;
        align-items: center;
        gap: 10px;
        padding: 6px 14px;
        border-radius: 999px;
        background: rgba(255, 255, 255, 0.86);
        color: var(--accent-strong);
        font-size: 0.85rem;
        font-weight: 600;
      }

      .mini-app-title {
        font-size: 0.95rem;
        font-weight: 600;
      }

      .mini-app-meta {
        margin: 0;
        color: var(--text-secondary);
        font-size: 0.8rem;
      }

      .icon-button {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 32px;
        height: 32px;
        border-radius: 999px;
        border: 1px solid transparent;
        background: rgba(79, 110, 247, 0.15);
        color: var(--accent-strong);
        cursor: pointer;
        transition: background 120ms ease, border 120ms ease, transform 120ms ease;
      }

      .icon-button:hover {
        background: rgba(79, 110, 247, 0.24);
      }

      .icon-button:focus-visible {
        outline: 2px solid rgba(79, 110, 247, 0.72);
        outline-offset: 2px;
      }

      .icon-button svg {
        width: 16px;
        height: 16px;
        fill: currentColor;
      }

      .client-panel header,
      .miniapp-panel header {
        display: grid;
        gap: 8px;
      }

      .miniapp-panel {
        position: relative;
        transition: box-shadow 160ms ease, border 160ms ease;
      }

      .miniapp-panel.is-collapsed [data-panel-content] {
        display: none;
      }

      .miniapp-panel.is-collapsed [data-panel-close] {
        display: none;
      }

      .miniapp-panel.is-collapsed [data-panel-placeholder] {
        display: grid;
      }

      .miniapp-panel-header {
        display: flex;
        flex-direction: column;
        gap: var(--space-sm);
      }

      .miniapp-panel-context {
        display: flex;
        align-items: center;
        gap: var(--space-xs);
        flex-wrap: wrap;
      }

      .miniapp-panel-meta {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: var(--space-sm);
        flex-wrap: wrap;
      }

      .miniapp-panel-meta p {
        margin: 0;
        color: var(--text-secondary);
        font-size: 0.85rem;
      }

      .miniapp-panel-body {
        margin-top: var(--layout-gap);
        display: grid;
        gap: var(--layout-gap);
      }

      .panel-placeholder {
        border-radius: var(--radius-medium);
        border: 1px dashed rgba(148, 163, 184, 0.6);
        background: rgba(148, 163, 184, 0.12);
        min-height: 160px;
        display: none;
        align-items: center;
        justify-content: center;
        text-align: center;
        padding: var(--space-lg);
        color: var(--text-secondary);
        font-size: 0.9rem;
        line-height: 1.5;
      }

      .panel-content {
        display: grid;
        gap: var(--layout-gap);
      }

      .miniapp-panel-close {
        margin-left: auto;
      }

      .miniapp-panel.is-active {
        border-color: var(--border-strong);
        box-shadow: 0 24px 48px rgba(79, 110, 247, 0.18);
      }

      .client-panel header h2,
      .miniapp-panel header h2 {
        margin: 0;
        font-size: clamp(1.4rem, 2.6vw, 1.8rem);
      }

      .client-panel header p,
      .miniapp-panel header p {
        margin: 0;
        font-size: 0.9rem;
        color: var(--text-secondary);
      }

      .panel-note {
        margin: var(--space-md) 0 0;
        font-size: 0.9rem;
        color: var(--text-secondary);
      }

      .placeholder-area {
        margin-top: var(--layout-gap);
        border-radius: var(--radius-medium);
        border: 1px dashed rgba(148, 163, 184, 0.5);
        background: rgba(148, 163, 184, 0.12);
      }

      .placeholder-area.large {
        min-height: 220px;
      }

      .master-grid {
        margin-top: var(--layout-gap);
        display: grid;
        gap: var(--layout-gap);
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      }

      .master-card {
        border-radius: var(--radius-medium);
        border: 1px dashed rgba(79, 110, 247, 0.36);
        background: rgba(79, 110, 247, 0.06);
        padding: var(--space-lg);
        display: grid;
        gap: var(--space-sm);
      }

      .master-card h3 {
        margin: 0;
        font-size: 1rem;
      }

      .empty-slot {
        border-radius: var(--radius-small);
        border: 1px dashed rgba(148, 163, 184, 0.6);
        background: rgba(255, 255, 255, 0.6);
        min-height: 100px;
      }

      .expansion-master {
        margin-top: var(--layout-gap);
        border-radius: var(--radius-medium);
        border: 1px dashed rgba(79, 110, 247, 0.4);
        background: rgba(79, 110, 247, 0.08);
        padding: var(--space-lg);
        display: grid;
        gap: var(--space-sm);
      }

      .expansion-master h3 {
        margin: 0;
        font-size: 1rem;
      }

      .empty-slot.tall {
        min-height: 160px;
      }

      .card {
        background: var(--surface);
        border-radius: var(--radius-large);
        border: 1px solid var(--border-color);
        box-shadow: var(--shadow-elevated);
        padding: var(--space-xl);
        backdrop-filter: blur(18px);
      }

      .card header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 12px;
        flex-wrap: wrap;
      }

      .card header h2,
      .card header h3 {
        margin: 0;
        font-size: 1.1rem;
      }

      .card header p {
        margin: 4px 0 0;
        color: var(--text-secondary);
        font-size: 0.85rem;
      }

      .panel-actions {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }

      .primary-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: var(--layout-gap);
        flex-wrap: wrap;
      }

      .eyebrow {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 6px 12px;
        border-radius: 999px;
        background: rgba(79, 110, 247, 0.12);
        color: var(--accent-strong);
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.08em;
      }

      .primary-header h2 {
        margin: 12px 0 4px;
        font-size: clamp(1.8rem, 3vw, 2.4rem);
      }

      .primary-header .meta {
        margin: 0;
        color: var(--text-secondary);
        font-size: 0.9rem;
      }

      .status-chip-group {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
      }

      .status-chip {
        display: inline-flex;
        align-items: center;
        padding: 8px 16px;
        border-radius: 999px;
        font-size: 0.85rem;
        font-weight: 600;
        border: 1px solid rgba(79, 110, 247, 0.2);
        background: rgba(79, 110, 247, 0.1);
        color: var(--accent-strong);
      }

      .status-chip--mirror {
        border-color: rgba(79, 110, 247, 0.28);
        background: rgba(79, 110, 247, 0.15);
      }

      .status-chip--safe {
        border-color: rgba(34, 197, 94, 0.25);
        background: var(--success-soft);
        color: var(--success);
      }

      .status-buttons {
        margin-top: var(--layout-gap);
        display: flex;
        flex-wrap: wrap;
        gap: var(--space-sm);
        align-items: center;
      }

      .status-button {
        border: 1px solid transparent;
        border-radius: 999px;
        padding: 10px 18px;
        font-weight: 600;
        font-size: 0.85rem;
        cursor: pointer;
        background: var(--surface-strong);
        color: var(--text-primary);
        transition: transform 120ms ease, box-shadow 120ms ease, border 120ms ease;
      }

      .status-button--new {
        border-color: rgba(245, 158, 11, 0.28);
        background: var(--warning-soft);
        color: var(--warning);
      }

      .status-button--execute {
        border-color: rgba(79, 110, 247, 0.28);
        background: rgba(79, 110, 247, 0.15);
        color: var(--accent-strong);
      }

      .status-button--ready {
        border-color: rgba(34, 197, 94, 0.25);
        background: var(--success-soft);
        color: var(--success);
      }

      .status-button--maintenance {
        border-color: rgba(148, 163, 184, 0.3);
        background: rgba(148, 163, 184, 0.16);
        color: var(--text-secondary);
      }

      .status-button:hover {
        transform: translateY(-1px);
        box-shadow: 0 10px 20px rgba(31, 42, 68, 0.12);
      }

      .status-pill {
        display: inline-flex;
        align-items: center;
        padding: 10px 18px;
        border-radius: 999px;
        background: rgba(79, 110, 247, 0.12);
        color: var(--accent-strong);
        font-size: 0.85rem;
        font-weight: 600;
        border: 1px dashed rgba(79, 110, 247, 0.4);
      }

      .badge-light {
        display: inline-flex;
        align-items: center;
        padding: 6px 12px;
        border-radius: 999px;
        background: rgba(79, 110, 247, 0.12);
        color: var(--accent-strong);
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.08em;
      }

      .sync-options {
        display: grid;
        gap: var(--layout-gap);
      }

      .option-group {
        display: grid;
        gap: var(--space-xs);
      }

      .group-label {
        font-size: 0.8rem;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        color: var(--text-secondary);
        font-weight: 600;
      }

      .option-pills {
        display: flex;
        flex-wrap: wrap;
        gap: var(--space-xs);
      }

      .option-pill {
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.4);
        background: rgba(148, 163, 184, 0.12);
        color: var(--text-secondary);
        font-size: 0.82rem;
        font-weight: 600;
        padding: 8px 16px;
        cursor: pointer;
      }

      .option-pill--active {
        border-color: rgba(79, 110, 247, 0.4);
        background: rgba(79, 110, 247, 0.18);
        color: var(--accent-strong);
      }

      .option-pill--ghost {
        background: rgba(148, 163, 184, 0.08);
      }

      .option-status {
        font-size: 0.78rem;
        color: var(--text-secondary);
        display: inline-flex;
        align-items: center;
        gap: 6px;
      }

      .option-status::before {
        content: "";
        width: 6px;
        height: 6px;
        border-radius: 50%;
        background: currentColor;
      }

      .option-status--offline {
        color: var(--danger);
      }

      .option-status--mirroring {
        color: var(--accent-strong);
      }

      .operations-highlights {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 16px;
      }

      .operations-highlights > div {
        border-radius: var(--radius-medium);
        border: 1px solid var(--border-color);
        background: var(--surface-strong);
        padding: 18px;
        display: grid;
        gap: 6px;
      }

      .operations-highlights p {
        margin: 0;
        color: var(--text-secondary);
        font-size: 0.85rem;
      }

      .field-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 16px;
      }

      .form-field {
        display: grid;
        gap: 8px;
        font-size: 0.85rem;
      }

      .form-field span {
        color: var(--text-secondary);
        font-weight: 600;
        letter-spacing: 0.02em;
      }

      .form-field input {
        border-radius: 12px;
        border: 1px solid var(--border-color);
        padding: 10px 14px;
        font-size: 0.95rem;
        font-family: inherit;
        color: var(--text-primary);
        background: #ffffff;
        box-shadow: inset 0 1px 2px rgba(15, 23, 42, 0.05);
      }

      .form-field input:focus {
        outline: none;
        border-color: rgba(79, 110, 247, 0.6);
        box-shadow: 0 0 0 3px rgba(79, 110, 247, 0.18);
      }

      .inline-note {
        margin-top: var(--layout-gap);
        border-radius: var(--radius-medium);
        border: 1px dashed rgba(79, 110, 247, 0.3);
        background: rgba(79, 110, 247, 0.08);
        padding: var(--space-md) var(--space-lg);
        display: grid;
        gap: var(--space-2xs);
      }

      .inline-note p {
        margin: 0;
        color: var(--text-secondary);
        font-size: 0.85rem;
      }

      .action-bar {
        margin-top: var(--layout-gap);
        display: flex;
        flex-wrap: wrap;
        gap: var(--space-sm);
      }

      .action-button {
        border-radius: 12px;
        border: 1px solid rgba(148, 163, 184, 0.4);
        background: var(--surface-strong);
        padding: 12px 18px;
        font-size: 0.85rem;
        font-weight: 600;
        color: var(--text-primary);
        cursor: pointer;
        transition: transform 120ms ease, box-shadow 120ms ease, border 120ms ease;
      }

      .action-button:hover {
        transform: translateY(-1px);
        box-shadow: 0 8px 18px rgba(31, 42, 68, 0.12);
      }

      .action-button--tests {
        border-color: rgba(79, 110, 247, 0.35);
      }

      .action-button--audit {
        border-color: rgba(34, 197, 94, 0.3);
      }

      .action-button--control {
        border-color: rgba(245, 158, 11, 0.3);
      }

      .kpi-section {
        display: grid;
        gap: var(--layout-gap);
      }

      .kpi-section header h3 {
        margin: 0;
        font-size: 1.1rem;
      }

      .kpi-section header p {
        margin: 0;
        color: var(--text-secondary);
        font-size: 0.85rem;
      }

      .kpi-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: var(--space-md);
      }

      .kpi-card {
        border-radius: var(--radius-medium);
        border: 1px solid rgba(79, 110, 247, 0.18);
        background: rgba(79, 110, 247, 0.12);
        padding: 18px;
        display: grid;
        gap: 8px;
      }

      .kpi-card span {
        font-size: 0.85rem;
        color: var(--text-secondary);
      }

      .kpi-card strong {
        font-size: 1.6rem;
      }

      .kpi-card small {
        color: var(--text-secondary);
        font-size: 0.78rem;
      }

      .insight-section {
        display: grid;
        gap: var(--layout-gap);
      }

      .insight-section header h3 {
        margin: 0;
        font-size: 1.1rem;
      }

      .insight-section header p {
        margin: 0;
        color: var(--text-secondary);
        font-size: 0.85rem;
      }

      .insight-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: var(--space-md);
      }

      .insight-card {
        border-radius: var(--radius-medium);
        border: 1px solid var(--border-color);
        background: var(--surface-strong);
        padding: 20px;
        display: grid;
        gap: 12px;
      }

      .insight-card h4 {
        margin: 0;
        font-size: 1rem;
      }

      .insight-card p {
        margin: 0;
        color: var(--text-secondary);
        font-size: 0.85rem;
      }

      .schedule-list {
        list-style: none;
        margin: 0;
        padding: 0;
        display: grid;
        gap: var(--space-sm);
      }

      .schedule-list li {
        display: flex;
        flex-direction: column;
        gap: var(--space-2xs);
        padding: var(--space-sm) var(--space-md);
        border-radius: var(--radius-small);
        border: 1px solid var(--border-color);
        background: var(--surface-strong);
      }

      .schedule-title {
        font-weight: 600;
        font-size: 0.9rem;
      }

      .schedule-time {
        font-size: 0.8rem;
        color: var(--text-secondary);
      }

      .panel-actions button,
      .pill-button {
        border: 1px solid rgba(79, 110, 247, 0.2);
        padding: 10px 18px;
        border-radius: 999px;
        background: rgba(79, 110, 247, 0.12);
        color: var(--accent-strong);
        font-size: 0.85rem;
        font-weight: 600;
        cursor: pointer;
        transition: transform 120ms ease, background 120ms ease, box-shadow 120ms ease;
      }

      .panel-actions button:hover,
      .pill-button:hover,
      .toggle:not(:disabled):hover {
        transform: translateY(-1px);
        background: rgba(79, 110, 247, 0.18);
        box-shadow: 0 10px 22px rgba(79, 110, 247, 0.18);
      }

      .panel-body {
        margin-top: var(--layout-gap);
        display: grid;
        gap: var(--layout-gap);
      }

      .status-strip {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: var(--space-md);
      }

      .status-tile {
        border-radius: var(--radius-medium);
        border: 1px solid rgba(59, 130, 246, 0.25);
        background: linear-gradient(145deg, rgba(14, 165, 233, 0.18), rgba(14, 116, 233, 0.12));
        padding: var(--space-md);
      }

      .status-tile strong {
        display: block;
        font-size: 1.6rem;
        margin-bottom: 6px;
      }

      .status-tile span {
        color: var(--text-secondary);
        font-size: 0.85rem;
      }

      .panel-highlights {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 18px;
      }

      .highlight-card {
        border-radius: var(--radius-medium);
        background: var(--surface-strong);
        border: 1px solid rgba(148, 163, 184, 0.18);
        padding: 20px;
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      .highlight-card h4 {
        margin: 0;
        font-size: 1rem;
      }

      .highlight-card p {
        margin: 0;
        font-size: 0.85rem;
        color: var(--text-secondary);
        flex: 1;
      }

      .mini-app-summary {
        margin: 18px 0 10px;
        font-size: 0.85rem;
        color: var(--text-secondary);
      }

      .mini-app-summary strong {
        color: var(--text-primary);
      }

      .mini-app-grid {
        margin-top: 12px;
        display: grid;
        gap: 16px;
      }


      .chip-row {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
      }

      .chip {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        border-radius: 999px;
        padding: 6px 12px;
        font-size: 0.75rem;
        font-weight: 600;
        background: rgba(148, 163, 184, 0.18);
        color: var(--text-secondary);
      }

      .chip.success {
        background: rgba(34, 197, 94, 0.18);
        color: var(--success);
      }

      .chip.info {
        background: rgba(79, 110, 247, 0.18);
        color: var(--accent-strong);
      }

      .chip.neutral {
        background: rgba(148, 163, 184, 0.14);
        color: var(--text-secondary);
      }

      .chip.warning {
        background: var(--warning-soft);
        color: var(--warning);
      }

      .grid-two {
        margin-top: var(--layout-gap);
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
        gap: var(--layout-gap);
      }

      .kpi-board {
        display: grid;
        gap: var(--space-sm);
      }

      .kpi-item {
        background: rgba(79, 110, 247, 0.12);
        border: 1px solid rgba(79, 110, 247, 0.3);
        border-radius: var(--radius-medium);
        padding: 16px;
      }

      .kpi-item strong {
        font-size: 1.4rem;
        display: block;
        margin-bottom: 4px;
      }

      .data-card {
        background: var(--surface-strong);
        border-radius: var(--radius-medium);
        border: 1px solid var(--border-color);
        padding: 18px;
        display: grid;
        gap: 10px;
      }

      .data-card h4 {
        margin: 0;
        font-size: 1rem;
      }

      .data-card ul {
        margin: 0;
        padding-left: 18px;
        color: var(--text-secondary);
        font-size: 0.85rem;
        display: grid;
        gap: 6px;
      }

      .expansion-area {
        margin-top: var(--layout-gap);
        background: rgba(79, 110, 247, 0.08);
        border: 1px dashed rgba(79, 110, 247, 0.36);
        border-radius: var(--radius-medium);
        padding: var(--space-lg);
      }

      .expansion-area h4 {
        margin: 0 0 var(--space-xs);
      }

      .expansion-area p {
        margin: 0;
        color: var(--text-secondary);
        font-size: 0.9rem;
      }

      .table-wrapper {
        margin-top: var(--layout-gap);
        background: var(--surface-strong);
        border-radius: var(--radius-large);
        border: 1px solid var(--border-color);
        padding: var(--space-lg);
        overflow-x: auto;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        min-width: 640px;
      }

      table thead {
        text-transform: uppercase;
        font-size: 0.75rem;
        letter-spacing: 0.08em;
        color: var(--text-secondary);
      }

      table th,
      table td {
        padding: var(--space-sm) var(--space-md);
        border-bottom: 1px solid rgba(187, 195, 216, 0.4);
        text-align: left;
      }

      table tbody tr:last-child td {
        border-bottom: none;
      }

      table td strong {
        color: var(--text-primary);
      }

      .system-tips {
        margin-top: var(--space-lg);
        border-radius: var(--radius-medium);
        border: 1px solid var(--border-color);
        background: var(--surface-strong);
        padding: var(--space-lg);
        display: grid;
        gap: var(--space-sm);
      }

      .system-tips h4 {
        margin: 0;
        font-size: 1rem;
      }

      .system-tips ul {
        margin: 0;
        padding-left: 18px;
        color: var(--text-secondary);
        font-size: 0.85rem;
        display: grid;
        gap: var(--space-2xs);
      }

      .device-list {
        display: grid;
        gap: 14px;
      }

      .device-card {
        border-radius: var(--radius-medium);
        border: 1px solid var(--border-color);
        padding: 16px;
        background: var(--surface-strong);
        display: grid;
        gap: 8px;
      }

      .device-card header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 12px;
      }

      .device-card header span {
        font-size: 0.82rem;
        color: var(--text-secondary);
      }

      .device-card ul {
        margin: 0;
        padding-left: 18px;
        color: var(--text-secondary);
        font-size: 0.8rem;
        display: grid;
        gap: 4px;
      }

      .storage-grid {
        display: grid;
        gap: 14px;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      }

      .storage-card {
        border-radius: var(--radius-medium);
        border: 1px solid rgba(56, 189, 248, 0.35);
        padding: 16px;
        background: rgba(14, 165, 233, 0.12);
        display: grid;
        gap: 6px;
      }

      .storage-card strong {
        font-size: 0.95rem;
      }

      .storage-card span {
        font-size: 0.8rem;
        color: var(--text-secondary);
      }

      .timeline {
        list-style: none;
        margin: 0;
        padding: 0;
        display: grid;
        gap: 12px;
      }

      .timeline li {
        position: relative;
        padding-left: 24px;
        font-size: 0.85rem;
        color: var(--text-secondary);
      }

      .timeline li::before {
        content: "";
        position: absolute;
        left: 0;
        top: 6px;
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background: var(--accent-strong);
        box-shadow: 0 0 10px rgba(79, 110, 247, 0.35);
      }

      .market-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
        gap: var(--space-md);
        margin-top: var(--layout-gap);
      }

      .market-card {
        border-radius: var(--radius-medium);
        border: 1px solid var(--border-color);
        background: var(--surface-strong);
        padding: var(--space-lg);
        display: grid;
        gap: var(--space-sm);
      }

      .market-card header h4 {
        margin: 0;
        font-size: 1rem;
      }

      .market-card header p {
        margin: 6px 0 0;
        font-size: 0.85rem;
        color: var(--text-secondary);
      }

      .market-card footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 12px;
        flex-wrap: wrap;
      }

      .toggle {
        border: 1px solid rgba(79, 110, 247, 0.25);
        border-radius: 999px;
        padding: 10px 20px;
        background: rgba(79, 110, 247, 0.12);
        color: var(--accent-strong);
        font-weight: 600;
        cursor: pointer;
        transition: transform 120ms ease, background 120ms ease;
      }

      .toggle:disabled {
        opacity: 0.55;
        cursor: not-allowed;
        transform: none;
        background: rgba(148, 163, 184, 0.2);
        border-color: rgba(148, 163, 184, 0.28);
        color: var(--text-secondary);
      }

      .config-block {
        background: var(--surface-strong);
        border: 1px solid var(--border-color);
        border-radius: var(--radius-medium);
        padding: var(--space-lg);
        margin-top: var(--layout-gap);
      }

      .config-block h4 {
        margin: 0 0 var(--space-sm);
      }

      .config-block pre {
        margin: 0;
        white-space: pre-wrap;
        font-size: 0.8rem;
        color: var(--text-secondary);
        max-height: 320px;
        overflow-y: auto;
        background: #f6f7ff;
        border-radius: var(--radius-small);
        padding: var(--space-md);
        border: 1px solid var(--border-color);
      }

      a.back-action {
        display: inline-flex;
        align-items: center;
        gap: var(--space-xs);
        margin-top: var(--layout-gap);
        font-size: 0.9rem;
        text-decoration: none;
        color: var(--accent);
        font-weight: 600;
      }

      a.back-action svg {
        width: 18px;
        height: 18px;
        fill: currentColor;
      }

      footer {
        margin-top: auto;
        padding: var(--space-lg) var(--layout-gutter) var(--space-xl);
        display: flex;
        justify-content: space-between;
        gap: var(--layout-gap);
        flex-wrap: wrap;
        align-items: center;
        font-size: 0.85rem;
        color: var(--text-secondary);
        border-top: 1px solid var(--border-color);
        background: var(--surface);
        border-radius: 0;
        box-shadow: none;
      }

      .footer-brand {
        display: flex;
        align-items: center;
      }

      .footer-brand img {
        height: 32px;
        object-fit: contain;
        display: block;
      }

      .footer-content {
        display: flex;
        flex-wrap: wrap;
        gap: var(--space-sm);
        align-items: center;
      }

      @media (max-width: 1200px) {
        .status-area {
          align-items: flex-start;
        }

        .status-meta {
          text-align: left;
        }
      }

      @media (max-width: 720px) {
        :root {
          --layout-gutter: 20px;
          --layout-gap: 20px;
        }

        header.app-header {
          padding: var(--space-lg) var(--layout-gutter);
        }

        main {
          padding: var(--space-lg) 0 calc(var(--space-lg) + var(--space-xl));
        }

        footer {
          padding: var(--space-lg) var(--layout-gutter) var(--space-xl);
        }

        table {
          min-width: 520px;
        }
      }
    </style>
  </head>
  <body>
    <header class="app-header">
      <!-- BEGIN: logo-picture-responsive -->
      <picture>
        <source srcset="/Projeto-marco/assets/app/brand/logo-dark-800.webp 800w, /Projeto-marco/assets/app/brand/logo-dark-400.webp 400w" media="(prefers-color-scheme: dark)" type="image/webp">
        <source srcset="/Projeto-marco/assets/app/brand/logo-light-800.webp 800w, /Projeto-marco/assets/app/brand/logo-light-400.webp 400w" media="(prefers-color-scheme: light)" type="image/webp">
        <img src="/Projeto-marco/assets/app/brand/logo-light-400.webp" alt="Logo 5 Horas" width="400" height="100" loading="eager" decoding="async">
      </picture>
      <!-- END: logo-picture-responsive -->
      <div class="logo-area">
        <div class="app-badge">Marco</div>
        <div class="title-group">
          <h1>Marco Â· AppBase + MiniApps</h1>
          <p>
            Aplicativo demonstrativo do Sistema Operacional Marco, com AppBase local-first
            carregando mini-apps habilitados por tenant e respeitando os contratos do
            blueprint consolidado.
          </p>
        </div>
      </div>
      <div class="status-area">
        <span class="status-indicator" data-ref="status-indicator">SessÃ£o ativa</span>
        <div class="status-meta">
          <span data-ref="status-tenant">Tenant:</span>
          <span data-ref="status-user">UsuÃ¡rio:</span>
          <span data-ref="status-storage">Armazenamento vinculado:</span>
          <span data-ref="status-sync">Ãltimo sync:</span>
          <span data-ref="status-ready">Tempo atÃ© READY:</span>
        </div>
      </div>
    </header>

    <main>
      <section id="tela-principal" class="view active">
        <div class="main-layout">
          <section class="card app-block miniapp-list">
            <header>
              <h3>Mini-app resumos</h3>
              <p>
                <span data-ref="miniapp-count">0</span> habilitados para
                <span data-ref="summary-tenant">-</span>
              </p>
            </header>
            <div class="miniapp-rail" id="mini-app-grid"></div>
          </section>
          <section class="card app-block app-metrics">
            <header>
              <span class="eyebrow">Indicadores</span>
              <h2>Snapshot operacional</h2>
              <p>Resumo rÃ¡pido de fluxo, capacidade e alertas do tenant ativo.</p>
            </header>
            <div class="app-metrics-grid">
              <article class="app-metric">
                <span>Fluxo de tarefas</span>
                <strong data-ref="metric-task-flow">â</strong>
              </article>
              <article class="app-metric">
                <span>Capacidade</span>
                <strong data-ref="metric-capacity">â</strong>
              </article>
              <article class="app-metric">
                <span>Alertas</span>
                <strong data-ref="metric-alerts">â</strong>
              </article>
            </div>
            <div class="app-metrics-highlights">
              <article class="app-highlight">
                <span>AprovaÃ§Ãµes</span>
                <strong data-ref="highlight-approvals">â</strong>
              </article>
              <article class="app-highlight">
                <span>Equipes em campo</span>
                <strong data-ref="highlight-field-teams">â</strong>
              </article>
              <article class="app-highlight">
                <span>Tarefas crÃ­ticas</span>
                <strong data-ref="highlight-priority">â</strong>
              </article>
            </div>
          </section>
          <section class="card app-block client-panel">
            <header>
              <span class="eyebrow">Painel cliente</span>
              <h2>Painel principal</h2>
              <p>Ãrea reservada para os componentes do cliente conforme o desenho base.</p>
            </header>
            <div class="placeholder-area large"></div>
          </section>
          <section
            class="card app-block miniapp-panel is-collapsed"
            id="miniapp-panel-card"
            aria-live="polite"
          >
            <header class="miniapp-panel-header">
              <div class="miniapp-panel-context">
                <span class="mini-app-chip" data-panel-chip>Mini-app nÃ£o selecionado</span>
                <button
                  type="button"
                  class="icon-button"
                  data-panel-menu
                  aria-label="Abrir MiniAppPanel"
                  aria-expanded="false"
                >
                  <svg viewBox="0 0 16 16" aria-hidden="true">
                    <path
                      d="M2.5 8a1.5 1.5 0 113 0 1.5 1.5 0 01-3 0zm4 0a1.5 1.5 0 113 0 1.5 1.5 0 01-3 0zm4 0a1.5 1.5 0 113 0 1.5 1.5 0 01-3 0z"
                    />
                  </svg>
                  <span class="sr-only">Alternar MiniAppPanel</span>
                </button>
              </div>
              <div class="miniapp-panel-meta">
                <p data-panel-meta>Selecione um mini-app na coluna Ã  esquerda para visualizar os masters.</p>
                <button type="button" class="pill-button miniapp-panel-close" data-panel-close hidden>
                  Fechar painel
                </button>
              </div>
            </header>
            <div class="miniapp-panel-body">
              <div class="panel-placeholder" data-panel-placeholder>
                Selecione um mini-app na coluna Ã  esquerda e utilize o menu de trÃªs pontos para abrir o MiniAppPanel.
              </div>
              <div class="panel-content" data-panel-content hidden></div>
            </div>
          </section>
        </div>
      </section>

      <template id="panel-template-operations">
        <div class="master-grid">
          <div class="master-card">
            <h3>KPIs do sistema</h3>
            <div class="empty-slot"></div>
          </div>
          <div class="master-card">
            <h3>Dados / Resumos</h3>
            <div class="empty-slot"></div>
          </div>
          <div class="master-card">
            <h3>Outros painÃ©is</h3>
            <div class="empty-slot"></div>
          </div>
        </div>
        <div class="expansion-master">
          <h3>Ãrea p/ expandir</h3>
          <div class="empty-slot tall"></div>
        </div>
      </template>

      <template id="panel-template-tasks">
        <p class="panel-note">
          O painel mestre do Gestor de Tarefas apresentarÃ¡ filtros, status e prÃ³ximos cards definidos nesta fase.
        </p>
        <div class="placeholder-area large"></div>
      </template>

      <template id="panel-template-account">
        <p class="panel-note">
          Ãrea reservada para vincular dispositivos, backups e livros-razÃ£o diretamente no painel central.
        </p>
        <div class="placeholder-area large"></div>
      </template>

      <template id="panel-template-market">
        <p class="panel-note">
          Em breve: catÃ¡logo compacto para habilitar ou revogar licenÃ§as sem sair da Home.
        </p>
        <div class="placeholder-area large"></div>
      </template>

      <template id="panel-template-settings">
        <p class="panel-note">
          ConfiguraÃ§Ãµes rÃ¡pidas do tenant, schemas registrados e observabilidade sumarizada aparecerÃ£o aqui.
        </p>
        <div class="placeholder-area large"></div>
      </template>

      <section id="mini-app-painel" class="view">
        <section class="card">
          <header>
            <div>
              <h2>Mini-app â¢ Painel de OperaÃ§Ãµes</h2>
              <p class="breadcrumbs">
                <span>Home</span><span>Mini-apps</span><span>Painel de OperaÃ§Ãµes</span>
              </p>
            </div>
          </header>
          <p class="panel-note">Masters base preparados para receber os subcards.</p>
          <div class="master-grid">
            <div class="master-card">
              <h3>KPIs do sistema</h3>
              <div class="empty-slot"></div>
            </div>
            <div class="master-card">
              <h3>Dados / Resumos</h3>
              <div class="empty-slot"></div>
            </div>
            <div class="master-card">
              <h3>Outros painÃ©is</h3>
              <div class="empty-slot"></div>
            </div>
          </div>
          <div class="expansion-master">
            <h3>Ãrea p/ expandir</h3>
            <div class="empty-slot tall"></div>
          </div>
          <a class="back-action" data-action="home" href="#">
            <svg viewBox="0 0 20 20" aria-hidden="true">
              <path
                d="M12.707 15.707a1 1 0 01-1.414 0L5.586 10l5.707-5.707a1 1 0 111.414 1.414L8.414 10l4.293 4.293a1 1 0 010 1.414z"
              />
            </svg>
            Voltar para a tela principal
          </a>
        </section>
      </section>

      <section id="mini-app-tarefas" class="view">
        <section class="card">
          <header>
            <div>
              <h2>Mini-app â¢ Gestor de Tarefas</h2>
              <p class="breadcrumbs">
                <span>Home</span><span>Mini-apps</span><span>Gestor de Tarefas</span>
              </p>
            </div>
            <div class="panel-actions">
              <button type="button">Criar nova tarefa</button>
              <button type="button">Exportar planilha</button>
            </div>
          </header>

          <div class="chip-row" style="margin-top: 16px">
            <span class="chip info">Filtro: Hoje</span>
            <span class="chip neutral">Owner: Todos</span>
            <span class="chip warning">4 itens crÃ­ticos</span>
          </div>

          <div class="table-wrapper">
            <table>
              <thead>
                <tr>
                  <th scope="col">Tarefas</th>
                  <th scope="col">ResponsÃ¡veis</th>
                  <th scope="col">Datas</th>
                  <th scope="col">Status</th>
                  <th scope="col">Dados consumidos</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><strong>Revisar contrato principal</strong></td>
                  <td>Carla Nogueira</td>
                  <td>12/03 â 14/03</td>
                  <td>
                    <span
                      class="status-indicator"
                      style="background: rgba(56, 189, 248, 0.15); color: var(--accent)"
                      >Em curso</span
                    >
                  </td>
                  <td>Base jurÃ­dica v2</td>
                </tr>
                <tr>
                  <td><strong>Sincronizar planilha de fornecedores</strong></td>
                  <td>Equipe OperaÃ§Ãµes</td>
                  <td>12/03 â 13/03</td>
                  <td>
                    <span
                      class="status-indicator"
                      style="background: rgba(34, 197, 94, 0.15); color: var(--success)"
                      >ConcluÃ­do</span
                    >
                  </td>
                  <td>InventÃ¡rio homologado</td>
                </tr>
                <tr>
                  <td><strong>Testar backups incrementais</strong></td>
                  <td>Marcos Lima</td>
                  <td>11/03 â 15/03</td>
                  <td>
                    <span
                      class="status-indicator"
                      style="background: rgba(249, 115, 22, 0.15); color: var(--warning)"
                      >AtenÃ§Ã£o</span
                    >
                  </td>
                  <td>Snapshots AWS 22h</td>
                </tr>
                <tr>
                  <td><strong>Validar checklist de campo</strong></td>
                  <td>Fernanda Dias</td>
                  <td>10/03 â 12/03</td>
                  <td>
                    <span
                      class="status-indicator"
                      style="background: rgba(239, 68, 68, 0.15); color: var(--danger)"
                      >CrÃ­tico</span
                    >
                  </td>
                  <td>DossiÃª Equipes Norte</td>
                </tr>
              </tbody>
            </table>
          </div>

          <div class="system-tips">
            <h4>Dicas do sistema</h4>
            <ul>
              <li>Use filtros por status para focar nos itens crÃ­ticos do dia.</li>
              <li>Os cartÃµes de dados consumidos indicam a fonte principal da tarefa.</li>
              <li>AtualizaÃ§Ãµes automÃ¡ticas acontecem a cada 15 minutos.</li>
            </ul>
          </div>

          <a class="back-action" data-action="home" href="#">
            <svg viewBox="0 0 20 20" aria-hidden="true">
              <path
                d="M12.707 15.707a1 1 0 01-1.414 0L5.586 10l5.707-5.707a1 1 0 111.414 1.414L8.414 10l4.293 4.293a1 1 0 010 1.414z"
              />
            </svg>
            Voltar para a tela principal
          </a>
        </section>
      </section>

      <section id="mini-app-conta" class="view">
        <section class="card">
          <header>
            <div>
              <h2>Mini-app â¢ Conta & Backup</h2>
              <p class="breadcrumbs">
                <span>Home</span><span>Mini-apps</span><span>Conta & Backup</span>
              </p>
            </div>
            <div class="panel-actions">
              <button type="button">Gerar link mÃ¡gico</button>
              <button type="button">Desvincular dispositivo</button>
            </div>
          </header>

          <div class="grid-two">
            <div class="data-card">
              <h4>Identidade & SessÃ£o</h4>
              <ul>
                <li>
                  Tenant atual: <strong data-ref="detail-tenant">-</strong>
                </li>
                <li>
                  UsuÃ¡rio autenticado: <strong data-ref="detail-user">-</strong>
                </li>
                <li>
                  Login unificado: <span data-ref="detail-logins">-</span>
                </li>
                <li>
                  Modo quiosque: <span data-ref="detail-kiosk">-</span>
                </li>
              </ul>
            </div>
            <div class="data-card">
              <h4>Backup & Storage</h4>
              <ul>
                <li>Backup automÃ¡tico: <strong data-ref="detail-backup">-</strong></li>
                <li>Arquivos sincronizados: <span data-ref="detail-files">-</span></li>
                <li>Ãltima exportaÃ§Ã£o: <span data-ref="detail-export">-</span></li>
              </ul>
            </div>
          </div>

          <div class="storage-grid" id="storage-grid"></div>

          <div class="grid-two">
            <div class="data-card">
              <h4>Dispositivos ativos</h4>
              <div class="device-list" id="device-list"></div>
            </div>
            <div class="data-card">
              <h4>Livro-razÃ£o de conformidade</h4>
              <ul class="timeline" id="audit-timeline"></ul>
            </div>
          </div>

          <div class="system-tips">
            <h4>Direitos do titular prontos para 1 clique</h4>
            <ul>
              <li>Acesso completo aos dados exportando o envelope Ãºnico.</li>
              <li>RetificaÃ§Ã£o centralizada com versionamento por schema.</li>
              <li>ExclusÃ£o total com janela de seguranÃ§a e recibo.</li>
            </ul>
          </div>

          <a class="back-action" data-action="home" href="#">
            <svg viewBox="0 0 20 20" aria-hidden="true">
              <path
                d="M12.707 15.707a1 1 0 01-1.414 0L5.586 10l5.707-5.707a1 1 0 111.414 1.414L8.414 10l4.293 4.293a1 1 0 010 1.414z"
              />
            </svg>
            Voltar para a tela principal
          </a>
        </section>
      </section>

      <section id="mini-app-market" class="view">
        <section class="card">
          <header>
            <div>
              <h2>Mini-app â¢ Marketplace</h2>
              <p class="breadcrumbs">
                <span>Home</span><span>Mini-apps</span><span>Marketplace</span>
              </p>
            </div>
            <div class="panel-actions">
              <button type="button">Atualizar catÃ¡logos</button>
              <button type="button">Ver licenÃ§as ativas</button>
            </div>
          </header>

          <div class="market-grid" id="market-grid"></div>

          <div class="system-tips">
            <h4>Como funciona o marketplace</h4>
            <ul>
              <li>Mini-apps obrigatÃ³rios ficam bloqueados para desativaÃ§Ã£o.</li>
              <li>AtivaÃ§Ãµes refletem imediatamente na Home e no AppBase.</li>
              <li>
                LicenÃ§as adicionais habilitam recursos como backup multi-dispositivo.
              </li>
            </ul>
          </div>

          <a class="back-action" data-action="home" href="#">
            <svg viewBox="0 0 20 20" aria-hidden="true">
              <path
                d="M12.707 15.707a1 1 0 01-1.414 0L5.586 10l5.707-5.707a1 1 0 111.414 1.414L8.414 10l4.293 4.293a1 1 0 010 1.414z"
              />
            </svg>
            Voltar para a tela principal
          </a>
        </section>
      </section>

      <section id="mini-app-config" class="view">
        <section class="card">
          <header>
            <div>
              <h2>Mini-app â¢ ConfiguraÃ§Ã£o & OperaÃ§Ã£o</h2>
              <p class="breadcrumbs">
                <span>Home</span><span>Mini-apps</span><span>ConfiguraÃ§Ã£o</span>
              </p>
            </div>
            <div class="panel-actions">
              <button type="button">Exportar config</button>
              <button type="button">Ver auditoria</button>
            </div>
          </header>

          <div class="config-block">
            <h4>ConfiguraÃ§Ã£o resolvida</h4>
            <pre id="config-json"></pre>
          </div>

          <div class="grid-two">
            <div class="data-card">
              <h4>Checklist LGPD-first</h4>
              <ul>
                <li>Consentimentos com recibo individual</li>
                <li>ExportaÃ§Ã£o 1-clique no envelope comum</li>
                <li>RetenÃ§Ã£o configurÃ¡vel por MiniApp</li>
              </ul>
            </div>
            <div class="data-card">
              <h4>Observabilidade</h4>
              <ul>
                <li>Eventos crÃ­ticos monitorados em tempo real</li>
                <li>KPIs alinhados ao blueprint R1.0</li>
                <li>Logs assinados por tenant e usuÃ¡rio</li>
              </ul>
            </div>
          </div>

          <div class="table-wrapper">
            <table>
              <thead>
                <tr>
                  <th scope="col">Evento</th>
                  <th scope="col">Ãltima captura</th>
                  <th scope="col">Notas</th>
                </tr>
              </thead>
              <tbody id="observability-table"></tbody>
            </table>
          </div>

          <a class="back-action" data-action="home" href="#">
            <svg viewBox="0 0 20 20" aria-hidden="true">
              <path
                d="M12.707 15.707a1 1 0 01-1.414 0L5.586 10l5.707-5.707a1 1 0 111.414 1.414L8.414 10l4.293 4.293a1 1 0 010 1.414z"
              />
            </svg>
            Voltar para a tela principal
          </a>
        </section>
      </section>
    </main>

    <footer>
      <div class="footer-brand">
        <img
          src="https://5horas.com.br/wp-content/uploads/2025/09/Logo-Banner2.png"
          alt="Logo 5horas"
          loading="lazy"
        />
      </div>
      <div class="footer-content">
        <span>Â© 2024 Marco â¢ Sistema Operacional Modular</span>
        <span>VersÃ£o 0.2.0 â¢ ProtÃ³tipo navegÃ¡vel AppBase + MiniApps</span>
      </div>
    </footer>

    <script>
      const views = document.querySelectorAll('.view');
      const appRoot = document.documentElement;
      const panelCard = document.getElementById('miniapp-panel-card');
      const panelContent = panelCard?.querySelector('[data-panel-content]');
      const panelPlaceholder = panelCard?.querySelector('[data-panel-placeholder]');
      const panelChip = panelCard?.querySelector('[data-panel-chip]');
      const panelMeta = panelCard?.querySelector('[data-panel-meta]');
      const panelClose = panelCard?.querySelector('[data-panel-close]');
      const panelMenu = panelCard?.querySelector('[data-panel-menu]');
      let activePanelKey = null;
      let activePanelTrigger = null;

      function activateView(id) {
        views.forEach((view) => {
          view.classList.toggle('active', view.id === id);
        });
        if (window.scrollY > 0) {
          window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        appRoot.setAttribute('data-view', id);
      }

      const dashboardSnapshot = {
        taskFlow: 82,
        capacity: 92,
        alerts: 3,
        approvals: 12,
        fieldTeams: 9,
        priorityTasks: 4,
      };

      const sessionState = {
        network: 'Online',
        deviceName: 'Marco Tablet Kiosk',
        lastSync: '12/03/2025 17:42',
        timeToReady: '1,4s',
        kioskMode: 'Device Owner â¢ Single-App Kiosk',
        devices: [
          {
            id: 'device-01',
            label: 'Marco Tablet Kiosk',
            type: 'Tablet',
            lastActivity: 'hÃ¡ 2 minutos',
            status: 'SessÃ£o atual',
          },
          {
            id: 'device-02',
            label: 'iPhone 15 â OperaÃ§Ãµes',
            type: 'Celular',
            lastActivity: 'hÃ¡ 1 hora',
            status: 'Login via Passkey',
          },
          {
            id: 'device-03',
            label: 'Desktop Backoffice',
            type: 'Desktop',
            lastActivity: 'hÃ¡ 3 horas',
            status: 'SessÃ£o ativa',
          },
        ],
        auditTrail: [
          {
            event: 'export_completed',
            description: 'ExportaÃ§Ã£o 1-clique concluÃ­da',
            timestamp: '12/03 17:21',
          },
          {
            event: 'erasure_requested',
            description: 'SolicitaÃ§Ã£o de eliminaÃ§Ã£o total agendada',
            timestamp: '12/03 14:02',
          },
          {
            event: 'consent_logged',
            description: 'Consentimento LGPD atualizado',
            timestamp: '11/03 18:45',
          },
        ],
      };

      const backupSnapshot = {
        enabled: true,
        filesSynced: '128 itens',
        lastExport: '12/03 17:21',
        storageStatus: {
          drive: {
            name: 'Google Drive',
            status: 'Operacional',
            lastSync: 'hÃ¡ 5 minutos',
          },
          onedrive: {
            name: 'Microsoft OneDrive',
            status: 'Operacional',
            lastSync: 'hÃ¡ 8 minutos',
          },
        },
      };

      const marketCatalog = [
        {
          key: 'operations',
          title: 'Painel de OperaÃ§Ãµes',
          description: 'KPIs, dados mestres e status unificado do tenant.',
          capabilities: ['KPIs', 'Alertas', 'Workflow'],
          license: 'Base',
        },
        {
          key: 'tasks',
          title: 'Gestor de Tarefas',
          description: 'Cronogramas, responsÃ¡veis e dependÃªncias crÃ­ticas.',
          capabilities: ['Quadro', 'Alertas', 'ExportaÃ§Ã£o'],
          license: 'Base',
        },
        {
          key: 'account',
          title: 'Conta & Backup',
          description: 'Identidade, dispositivos, direitos do titular e backups.',
          capabilities: ['LGPD', 'Backup', 'Passkeys'],
          license: 'Premium',
        },
        {
          key: 'market',
          title: 'Marketplace',
          description: 'GestÃ£o de catÃ¡logos, licenÃ§as e habilitaÃ§Ã£o de MiniApps.',
          capabilities: ['CatÃ¡logo', 'LicenÃ§as', 'Provisionamento'],
          license: 'Base',
        },
        {
          key: 'settings',
          title: 'ConfiguraÃ§Ã£o & OperaÃ§Ã£o',
          description: 'ParÃ¢metros do AppBase, observabilidade e auditoria.',
          capabilities: ['Schemas', 'Observabilidade', 'LGPD'],
          license: 'Base',
        },
        {
          key: 'analytics',
          title: 'Insights AvanÃ§ados',
          description: 'VisualizaÃ§Ãµes analÃ­ticas e previsÃµes operacionais.',
          capabilities: ['Forecast', 'AnÃ¡lises', 'Dashboards'],
          license: 'Add-on',
          comingSoon: true,
        },
      ];

      const observabilitySnapshot = [
        {
          event: 'boot_start',
          timestamp: '12/03 17:00',
          notes: 'Fluxo nominal',
        },
        {
          event: 'config_loaded',
          timestamp: '12/03 17:00',
          notes: 'Checksum vÃ¡lido',
        },
        {
          event: 'session_ok',
          timestamp: '12/03 17:01',
          notes: 'Token renovado via PKCE',
        },
        {
          event: 'sync_completed',
          timestamp: '12/03 17:42',
          notes: 'Fila zerada',
        },
        {
          event: 'export_completed',
          timestamp: '12/03 17:21',
          notes: 'Envelope distribuÃ­do',
        },
      ];

      const AppBase = (() => {
        const modules = new Map();
        const defaults = new Set();
        let enabled = new Set();
        let currentConfig = null;

        function register(key, module) {
          modules.set(key, module);
        }

        function boot(config) {
          currentConfig = config;
          defaults.clear();
          (config.defaults?.enabledMiniApps ?? []).forEach((key) => defaults.add(key));
          enabled = new Set([
            ...(config.defaults?.enabledMiniApps ?? []),
            ...(config.user?.enabledMiniApps ?? []),
          ]);
          refreshNav();
        }

        function refreshNav() {
          const enabledKeys = Array.from(enabled).filter((key) => modules.has(key));
          const container = document.getElementById('mini-app-grid');
          if (container) {
            container.innerHTML = '';
            enabledKeys.forEach((key) => {
              const module = modules.get(key);
              container.appendChild(createMiniAppCard(module, key));
            });
          }
          const countRef = document.querySelector('[data-ref="miniapp-count"]');
          if (countRef) {
            countRef.textContent = enabledKeys.length;
          }
          const tenantSummary = document.querySelector('[data-ref="summary-tenant"]');
          if (tenantSummary && currentConfig) {
            tenantSummary.textContent = currentConfig.tenantId;
          }
          connectMiniAppTriggers();
          buildMarketplace();
        }

        function createMiniAppCard(module, key) {
          const article = document.createElement('article');
          article.className = 'mini-app-card';
          article.dataset.miniapp = key;
          article.dataset.miniappView = key;
          article.tabIndex = 0;
          article.setAttribute('role', 'button');
          article.setAttribute('aria-label', `Abrir visÃ£o completa de ${module.card.label}`);

          const header = document.createElement('div');
          header.className = 'mini-app-card-header';

          const chip = document.createElement('div');
          chip.className = 'mini-app-chip';

          const title = document.createElement('span');
          title.className = 'mini-app-title';
          title.textContent = module.card.label;
          chip.appendChild(title);

          const trigger = document.createElement('button');
          trigger.type = 'button';
          trigger.className = 'icon-button';
          trigger.dataset.panelTrigger = key;
          trigger.setAttribute('aria-label', `Abrir MiniAppPanel de ${module.card.label}`);
          trigger.setAttribute('aria-expanded', 'false');
          trigger.innerHTML = `
            <svg viewBox="0 0 16 16" aria-hidden="true">
              <path d="M2.5 8a1.5 1.5 0 113 0 1.5 1.5 0 01-3 0zm4 0a1.5 1.5 0 113 0 1.5 1.5 0 01-3 0zm4 0a1.5 1.5 0 113 0 1.5 1.5 0 01-3 0z" />
            </svg>
            <span class="sr-only">Abrir painel de mini-app</span>
          `;

          chip.appendChild(trigger);
          header.appendChild(chip);
          article.appendChild(header);

          if (module.card?.meta) {
            const meta = document.createElement('p');
            meta.className = 'mini-app-meta';
            meta.textContent = module.card.meta;
            article.appendChild(meta);
          }

          article.addEventListener('click', (event) => {
            if (event.target.closest('button')) {
              return;
            }
            activateView(module.id);
          });

          article.addEventListener('keydown', (event) => {
            if (event.key === 'Enter' || event.key === ' ') {
              event.preventDefault();
              activateView(module.id);
            }
          });

          article.dataset.bound = 'true';

          return article;
        }

        function toggleMiniApp(key) {
          if (!modules.has(key) && !defaults.has(key)) {
            return;
          }
          const module = modules.get(key);
          if (enabled.has(key)) {
            if (defaults.has(key)) {
              return;
            }
            enabled.delete(key);
            if (activePanelKey === key) {
              hideMiniAppPanel();
            }
            if (module && appRoot.dataset.view === module.id) {
              activateView('tela-principal');
            }
          } else {
            enabled.add(key);
          }
          refreshNav();
        }

        function isEnabled(key) {
          return enabled.has(key);
        }

        function isDefault(key) {
          return defaults.has(key);
        }

        function getResolvedConfig() {
          if (!currentConfig) {
            return null;
          }
          return {
            tenantId: currentConfig.tenantId,
            userId: currentConfig.userId,
            catalogBaseUrl: currentConfig.catalogBaseUrl,
            enabledMiniApps: Array.from(enabled),
            entitlements: currentConfig.user?.entitlements ?? {},
            providers: currentConfig.user?.providers ?? {},
            ui: currentConfig.ui,
            meta: currentConfig.meta,
          };
        }

        function resolve(key) {
          return modules.get(key);
        }

        return {
          register,
          boot,
          toggleMiniApp,
          isEnabled,
          isDefault,
          getResolvedConfig,
          resolve,
        };
      })();

      AppBase.register('operations', {
        id: 'mini-app-painel',
        card: {
          label: 'Painel de OperaÃ§Ãµes',
          meta: 'KPIs, dados mestres e status de recursos',
          cta: 'Abrir painel detalhado',
        },
        badges: ['KPIs', 'Alertas'],
        panel: {
          template: 'panel-template-operations',
          meta: 'Masters do painel operacional prontos para receber subcards.',
        },
      });

      AppBase.register('tasks', {
        id: 'mini-app-tarefas',
        card: {
          label: 'Gestor de Tarefas',
          meta: 'Cronogramas, responsÃ¡veis e dados consumidos',
          cta: 'Abrir lista de tarefas',
        },
        badges: ['Workflow', 'Autosave'],
        panel: {
          template: 'panel-template-tasks',
          meta: 'Masters do gestor focados em filtros e status prioritÃ¡rios.',
        },
      });

      AppBase.register('account', {
        id: 'mini-app-conta',
        card: {
          label: 'Conta & Backup',
          meta: 'Identidade, dispositivos e direitos LGPD',
          cta: 'Gerenciar conta',
        },
        badges: ['LGPD', 'Backup'],
        panel: {
          template: 'panel-template-account',
          meta: 'Masters para direitos do titular, dispositivos e backups.',
        },
      });

      AppBase.register('market', {
        id: 'mini-app-market',
        card: {
          label: 'Marketplace',
          meta: 'CatÃ¡logo confiÃ¡vel de mini-apps do tenant',
          cta: 'Gerenciar licenÃ§as',
        },
        badges: ['CatÃ¡logo', 'Provisionamento'],
        panel: {
          template: 'panel-template-market',
          meta: 'Preview compacto para habilitar ou revogar licenÃ§as.',
        },
      });

      AppBase.register('settings', {
        id: 'mini-app-config',
        card: {
          label: 'ConfiguraÃ§Ã£o & OperaÃ§Ã£o',
          meta: 'Parametros, observabilidade e auditoria',
          cta: 'Abrir configuraÃ§Ãµes',
        },
        badges: ['Schemas', 'Logs'],
        panel: {
          template: 'panel-template-settings',
          meta: 'Masters de configuraÃ§Ã£o rÃ¡pida e observabilidade do tenant.',
        },
      });

      const bootConfig = {
        tenantId: 'tenant-marco',
        userId: 'ribeiro.l',
        catalogBaseUrl: 'https://cdn.marco.app/catalog',
        defaults: { enabledMiniApps: ['home', 'market', 'settings'] },
        user: {
          enabledMiniApps: ['operations', 'tasks', 'account'],
          entitlements: { backup: true, marketplace: true },
          providers: { login: ['google', 'apple'], storage: ['drive', 'onedrive'] },
        },
        ui: { theme: 'dark', layout: 'tabs' },
        meta: { version: '1.0', signature: 'demo-signature', checksum: 'demo-checksum' },
      };

      AppBase.boot(bootConfig);

      updateHeaderSession(bootConfig, sessionState);
      updateHomeSnapshot(dashboardSnapshot);
      updateAccountDetails(bootConfig, sessionState, backupSnapshot);
      buildObservabilityTable();
      connectMiniAppTriggers();
      document.querySelectorAll('[data-action="home"]').forEach((element) => {
        element.addEventListener('click', (event) => {
          event.preventDefault();
          activateView('tela-principal');
        });
      });

      function updateHeaderSession(config, session) {
        const indicator = document.querySelector('[data-ref="status-indicator"]');
        if (indicator) {
          indicator.textContent = `SessÃ£o ativa â¢ ${session.network}`;
        }
        const tenantRef = document.querySelector('[data-ref="status-tenant"]');
        if (tenantRef) {
          tenantRef.textContent = `Tenant: ${config.tenantId}`;
        }
        const userRef = document.querySelector('[data-ref="status-user"]');
        if (userRef) {
          userRef.textContent = `UsuÃ¡rio: ${config.userId} â¢ ${session.deviceName}`;
        }
        const storageProviders = config.user?.providers?.storage ?? [];
        const storageRef = document.querySelector('[data-ref="status-storage"]');
        if (storageRef) {
          storageRef.textContent = storageProviders.length
            ? `Armazenamento vinculado: ${storageProviders
                .map((provider) => provider.toUpperCase())
                .join(' â¢ ')}`
            : 'Armazenamento vinculado: nÃ£o habilitado';
        }
        const syncRef = document.querySelector('[data-ref="status-sync"]');
        if (syncRef) {
          syncRef.textContent = session.lastSync
            ? `Ãltimo sync: ${session.lastSync}`
            : 'Sync desativado';
        }
        const readyRef = document.querySelector('[data-ref="status-ready"]');
        if (readyRef) {
          readyRef.textContent = `Tempo atÃ© READY: ${session.timeToReady}`;
        }
      }

      function updateHomeSnapshot(snapshot) {
        const flow = document.querySelector('[data-ref="metric-task-flow"]');
        if (flow) {
          flow.textContent = `${snapshot.taskFlow}%`;
        }
        const capacity = document.querySelector('[data-ref="metric-capacity"]');
        if (capacity) {
          capacity.textContent = `${snapshot.capacity}%`;
        }
        const alerts = document.querySelector('[data-ref="metric-alerts"]');
        if (alerts) {
          alerts.textContent = snapshot.alerts;
        }
        const approvals = document.querySelector('[data-ref="highlight-approvals"]');
        if (approvals) {
          approvals.textContent = snapshot.approvals;
        }
        const teams = document.querySelector('[data-ref="highlight-field-teams"]');
        if (teams) {
          teams.textContent = snapshot.fieldTeams;
        }
        const priority = document.querySelector('[data-ref="highlight-priority"]');
        if (priority) {
          priority.textContent = snapshot.priorityTasks;
        }
      }

      function updateAccountDetails(config, session, backup) {
        const tenantDetail = document.querySelector('[data-ref="detail-tenant"]');
        if (tenantDetail) {
          tenantDetail.textContent = config.tenantId;
        }
        const userDetail = document.querySelector('[data-ref="detail-user"]');
        if (userDetail) {
          userDetail.textContent = config.userId;
        }
        const loginDetail = document.querySelector('[data-ref="detail-logins"]');
        if (loginDetail) {
          const providers = config.user?.providers?.login ?? [];
          loginDetail.textContent = providers.length
            ? providers.map((provider) => provider.toUpperCase()).join(' â¢ ')
            : 'Sem provedores configurados';
        }
        const kioskDetail = document.querySelector('[data-ref="detail-kiosk"]');
        if (kioskDetail) {
          kioskDetail.textContent = session.kioskMode;
        }
        const backupDetail = document.querySelector('[data-ref="detail-backup"]');
        if (backupDetail) {
          backupDetail.textContent = backup.enabled ? 'Ativo' : 'Desativado';
        }
        const filesDetail = document.querySelector('[data-ref="detail-files"]');
        if (filesDetail) {
          filesDetail.textContent = backup.filesSynced;
        }
        const exportDetail = document.querySelector('[data-ref="detail-export"]');
        if (exportDetail) {
          exportDetail.textContent = backup.lastExport;
        }

        const storageGrid = document.getElementById('storage-grid');
        if (storageGrid) {
          storageGrid.innerHTML = '';
          const storageProviders = config.user?.providers?.storage ?? [];
          storageProviders.forEach((providerKey) => {
            const data = backup.storageStatus[providerKey];
            const card = document.createElement('article');
            card.className = 'storage-card';
            card.innerHTML = `
              <strong>${data?.name ?? providerKey.toUpperCase()}</strong>
              <span>Status: ${data?.status ?? 'Desconhecido'}</span>
              <span>Ãltimo sync: ${data?.lastSync ?? 'â'}</span>
            `;
            storageGrid.appendChild(card);
          });
        }

        const deviceList = document.getElementById('device-list');
        if (deviceList) {
          deviceList.innerHTML = '';
          session.devices.forEach((device) => {
            const card = document.createElement('article');
            card.className = 'device-card';
            card.innerHTML = `
              <header>
                <strong>${device.label}</strong>
                <span>${device.status}</span>
              </header>
              <ul>
                <li>Tipo: ${device.type}</li>
                <li>Ãltima atividade: ${device.lastActivity}</li>
                <li>ID: ${device.id}</li>
              </ul>
            `;
            deviceList.appendChild(card);
          });
        }

        const timeline = document.getElementById('audit-timeline');
        if (timeline) {
          timeline.innerHTML = '';
          session.auditTrail.forEach((entry) => {
            const item = document.createElement('li');
            item.textContent = `${entry.timestamp} â¢ ${entry.description}`;
            timeline.appendChild(item);
          });
        }

        const configJson = document.getElementById('config-json');
        if (configJson) {
          const resolved = AppBase.getResolvedConfig();
          configJson.textContent = JSON.stringify(resolved, null, 2);
        }
      }

      function toggleMiniAppPanel(key, trigger) {
        if (!panelCard || !panelContent || !panelPlaceholder) {
          return;
        }
        if (activePanelKey === key && panelCard.classList.contains('is-active')) {
          hideMiniAppPanel();
          return;
        }
        showMiniAppPanel(key, trigger);
      }

      function showMiniAppPanel(key, trigger) {
        const module = AppBase.resolve(key);
        if (!module || !panelCard || !panelContent || !panelPlaceholder) {
          return;
        }

        panelContent.innerHTML = '';
        const templateId = module.panel?.template;
        if (templateId) {
          const template = document.getElementById(templateId);
          if (template) {
            panelContent.appendChild(template.content.cloneNode(true));
          }
        }
        if (!panelContent.hasChildNodes()) {
          const fallback = document.createElement('p');
          fallback.className = 'panel-note';
          fallback.textContent = `Painel em preparaÃ§Ã£o para ${module.card.label}.`;
          panelContent.appendChild(fallback);
        }

        panelPlaceholder.setAttribute('hidden', 'hidden');
        panelContent.removeAttribute('hidden');
        panelCard.classList.add('is-active');
        panelCard.classList.remove('is-collapsed');

        if (panelChip) {
          panelChip.textContent = module.card.label;
        }
        if (panelMeta) {
          panelMeta.textContent = module.panel?.meta ?? module.card?.meta ?? '';
        }

        if (panelClose) {
          panelClose.removeAttribute('hidden');
        }

        if (panelMenu) {
          panelMenu.dataset.panelTrigger = key;
          panelMenu.setAttribute('aria-expanded', 'true');
          panelMenu.setAttribute('aria-label', `Fechar MiniAppPanel de ${module.card.label}`);
        }

        if (activePanelTrigger) {
          activePanelTrigger.setAttribute('aria-expanded', 'false');
        }
        if (trigger) {
          trigger.setAttribute('aria-expanded', 'true');
          activePanelTrigger = trigger;
        } else {
          activePanelTrigger = null;
        }

        activePanelKey = key;
      }

      function hideMiniAppPanel() {
        if (!panelCard || !panelContent || !panelPlaceholder) {
          return;
        }
        panelCard.classList.remove('is-active');
        panelCard.classList.add('is-collapsed');
        panelContent.innerHTML = '';
        panelContent.setAttribute('hidden', 'hidden');
        panelPlaceholder.removeAttribute('hidden');

        if (panelChip) {
          panelChip.textContent = 'Mini-app nÃ£o selecionado';
        }
        if (panelMeta) {
          panelMeta.textContent = 'Selecione um mini-app na coluna Ã  esquerda para visualizar os masters.';
        }
        if (panelClose) {
          panelClose.setAttribute('hidden', 'hidden');
        }
        if (panelMenu) {
          panelMenu.removeAttribute('data-panel-trigger');
          panelMenu.setAttribute('aria-expanded', 'false');
          panelMenu.setAttribute('aria-label', 'Abrir MiniAppPanel');
        }
        if (activePanelTrigger) {
          activePanelTrigger.setAttribute('aria-expanded', 'false');
        }
        activePanelTrigger = null;
        activePanelKey = null;
      }

      if (panelClose) {
        panelClose.addEventListener('click', (event) => {
          event.stopPropagation();
          hideMiniAppPanel();
        });
      }

      if (panelMenu) {
        panelMenu.addEventListener('click', (event) => {
          event.stopPropagation();
          const targetKey = panelMenu.dataset.panelTrigger ?? activePanelKey;
          if (targetKey) {
            toggleMiniAppPanel(targetKey, panelMenu);
          }
        });
      }

      function connectMiniAppTriggers() {
        document.querySelectorAll('[data-miniapp-view]').forEach((element) => {
          if (element.dataset.bound === 'true') {
            return;
          }
          const module = AppBase.resolve(element.dataset.miniappView);
          if (!module) {
            return;
          }
          element.dataset.bound = 'true';
          element.addEventListener('click', (event) => {
            if (event.target.closest('button')) {
              return;
            }
            activateView(module.id);
          });
        });

        document.querySelectorAll('[data-panel-trigger]').forEach((button) => {
          if (button.dataset.panelBound === 'true') {
            return;
          }
          button.dataset.panelBound = 'true';
          button.addEventListener('click', (event) => {
            event.stopPropagation();
            toggleMiniAppPanel(button.dataset.panelTrigger, button);
          });
        });
      }

      function buildMarketplace() {
        const container = document.getElementById('market-grid');
        if (!container) {
          return;
        }
        container.innerHTML = '';
        marketCatalog.forEach((item) => {
          const card = document.createElement('article');
          card.className = 'market-card';
          card.dataset.marketCard = item.key;

          const header = document.createElement('header');
          header.innerHTML = `
            <div>
              <h4>${item.title}</h4>
              <p>${item.description}</p>
            </div>
          `;
          card.appendChild(header);

          if (item.capabilities?.length) {
            const chips = document.createElement('div');
            chips.className = 'chip-row';
            item.capabilities.forEach((capability) => {
              const chip = document.createElement('span');
              chip.className = 'chip neutral';
              chip.textContent = capability;
              chips.appendChild(chip);
            });
            card.appendChild(chips);
          }

          const statusRow = document.createElement('div');
          statusRow.className = 'chip-row';
          const statusChip = document.createElement('span');
          if (item.comingSoon) {
            statusChip.className = 'chip neutral';
            statusChip.textContent = 'Em breve';
          } else if (AppBase.isEnabled(item.key)) {
            statusChip.className = 'chip success';
            statusChip.textContent = 'Ativo';
          } else {
            statusChip.className = 'chip info';
            statusChip.textContent = 'DisponÃ­vel';
          }
          statusRow.appendChild(statusChip);

          if (item.license) {
            const licenseChip = document.createElement('span');
            licenseChip.className = 'chip neutral';
            licenseChip.textContent = `LicenÃ§a: ${item.license}`;
            statusRow.appendChild(licenseChip);
          }
          card.appendChild(statusRow);

          const footer = document.createElement('footer');
          if (item.comingSoon) {
            const info = document.createElement('span');
            info.className = 'chip neutral';
            info.textContent = 'CatÃ¡logo agendado para Q3';
            footer.appendChild(info);
          } else {
            const toggle = document.createElement('button');
            toggle.className = 'toggle';
            toggle.type = 'button';
            if (AppBase.isDefault(item.key)) {
              toggle.textContent = 'ObrigatÃ³rio';
              toggle.disabled = true;
            } else {
              toggle.textContent = AppBase.isEnabled(item.key) ? 'Desabilitar' : 'Habilitar';
              toggle.addEventListener('click', () => {
                AppBase.toggleMiniApp(item.key);
              });
            }
            footer.appendChild(toggle);
          }
          card.appendChild(footer);

          container.appendChild(card);
        });
      }

      function buildObservabilityTable() {
        const tbody = document.getElementById('observability-table');
        if (!tbody) {
          return;
        }
        tbody.innerHTML = '';
        observabilitySnapshot.forEach((entry) => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td><strong>${entry.event}</strong></td>
            <td>${entry.timestamp}</td>
            <td>${entry.notes}</td>
          `;
          tbody.appendChild(row);
        });
      }
    </script>
  </body>
</html>
