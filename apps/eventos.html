<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gerenciar Eventos — AC (v2) + Mini‑Apps Fornecedores & Convidados</title>
</head>
<body>
  <main class="ac">
    <div class="container">
      <!-- ===================== TOP / RESUMO ===================== -->
      <section class="card" id="cardResumo">
        <div class="row" style="align-items:flex-start; gap:16px">
          <div>
            <h1 class="app-title">Gestão de eventos</h1>
            <h2 id="evTitle">—</h2>
            <div class="small muted" id="updatedWrap">Atualizado: <span id="updatedAt">—</span>
              <span id="storageWarn" class="pill pillwarn" style="display:none;margin-left:8px">Modo temporário (sem persistência)</span>
            </div>
          </div>

          <div class="select-block" style="margin-left:auto; min-width:min(520px, 100%)">
            <label class="small" for="switchEvent">Selecionar evento</label>
            <select id="switchEvent"></select>

            <div class="row" id="hdrControlsRow" style="align-items:center; gap:8px; flex-wrap:wrap">
              <button id="btnNew" class="btn btn--ghost" type="button">Novo</button>
              <button id="btnDelete" class="btn btn--ghost danger" type="button">Excluir</button>
              <!-- Pílulas de status -->
              <span id="chipReady"  class="pill pillok">Pronto</span>
              <span id="chipDirty"  class="pill pillwarn"   style="display:none">Edição não salva</span>
              <span id="chipSaving" class="pill pillsaving" style="display:none">Salvando…</span>

              <!-- Badge de Sync no topo (etiqueta com lápis) -->
              <div class="hdr-sync" id="hdr_sync_wrap">
                <span class="small-label">Sincronização</span>
                <div class="badge" id="hdr_sync_badge">
                  <span id="hdr_sync_status">Desativado</span>
                  <button class="edit-btn" data-open="#secSync" aria-label="Abrir painel de sincronização" title="Abrir painel de sincronização">✎</button>
                </div>
                <span id="hdr_sync_detail" class="small muted">—</span>
              </div>
            </div>
          </div>
        </div>

        <!-- BADGES -->
        <div class="badge-grid" aria-label="Resumo do evento">
          <div class="badge" id="badgeEvento">
            <h3>Evento</h3>
            <div><dl class="kv" id="kvEvento"></dl></div>
            <div class="actions"><button class="edit-btn" data-open="#secEvento" aria-label="Editar">✎</button></div>
          </div>

          <div class="badge" id="badgeAnfitriao">
            <h3>Anfitrião</h3>
            <div><dl class="kv" id="kvAnfitriao"></dl></div>
            <div class="actions"><button class="edit-btn" data-open="#secAnfitriao" aria-label="Editar">✎</button></div>
          </div>

          <div class="badge" id="badgeCerimonial">
            <h3>Cerimonialista</h3>
            <div><dl class="kv" id="kvCerimonial"></dl></div>
            <div class="actions"><button class="edit-btn" data-open="#secCerimonial" aria-label="Editar">✎</button></div>
          </div>
        </div>

        <!-- EDIÇÃO (um aberto por vez) -->
        <details id="secEvento"><summary>Evento</summary>
          <div class="details-wrap">
            <div class="twocol">
              <div class="field">
                <label><span class="small">Nome do evento</span></label>
                <input data-bind="evento.nome" type="text" />
              </div>
              <div class="field">
                <label><span class="small">Tipo</span></label>
                <select data-bind="evento.tipo">
                  <option value=""></option>
                  <option>Casamento</option><option>Aniversário</option><option>Formatura</option>
                  <option>Debutante</option><option>Corporativo</option><option>Batizado</option>
                  <option>Chá de Panela</option><option>Chá de Bebê</option><option>Bodas</option><option>Outro</option>
                </select>
              </div>
            </div>

            <div class="twocol">
              <div class="field">
                <label><span class="small">Quando</span></label>
                <input id="ev-datetime" type="datetime-local" />
              </div>
              <div class="field">
                <label><span class="small">Local</span></label>
                <input data-bind="evento.local" type="text" />
              </div>
            </div>

            <div><strong class="small">Endereço do evento</strong></div>

            <div class="twocol">
              <div class="field">
                <label><span class="small">CEP</span></label>
                <input data-bind="evento.endereco.cep" type="text" inputmode="numeric" maxlength="9" data-cep="evento.endereco" />
              </div>
              <div class="field">
                <label><span class="small">Logradouro</span></label>
                <input data-bind="evento.endereco.logradouro" type="text" />
              </div>
            </div>

            <div class="threecol">
              <div class="field">
                <label><span class="small">Número</span></label>
                <input data-bind="evento.endereco.numero" type="text" />
              </div>
              <div class="field">
                <label><span class="small">Bairro</span></label>
                <input data-bind="evento.endereco.bairro" type="text" />
              </div>
              <div class="field">
                <label><span class="small">Cidade</span></label>
                <input data-bind="evento.endereco.cidade" type="text" />
              </div>
            </div>

            <div class="twocol">
              <div class="field">
                <label><span class="small">UF</span></label>
                <input data-bind="evento.endereco.uf" type="text" maxlength="2" />
              </div>
              <div class="field">
                <label><span class="small">Complemento / Referência</span></label>
                <input data-bind="evento.endereco.complemento" type="text" />
              </div>
            </div>

            <div class="close-hint">Pressione <strong>Esc</strong> ou clique no lápis novamente para fechar.</div>
          </div>
        </details>

        <details id="secAnfitriao"><summary>Anfitrião</summary>
          <div class="details-wrap">
            <div class="twocol">
              <div class="field">
                <label><span class="small">Nome</span></label>
                <input data-bind="evento.anfitriao.nome" type="text" />
              </div>
              <div class="field">
                <label><span class="small">Telefone</span></label>
                <input data-bind="evento.anfitriao.telefone" type="text" />
              </div>
            </div>

            <div class="field">
              <label><span class="small">Rede social / contato</span></label>
              <input data-bind="evento.anfitriao.redeSocial" type="text" />
            </div>

            <div><strong class="small">Endereço para correspondência</strong></div>

            <div class="twocol">
              <div class="field">
                <label><span class="small">CEP</span></label>
                <input data-bind="evento.anfitriao.endCorrespondencia.cep" type="text" inputmode="numeric" maxlength="9" data-cep="evento.anfitriao.endCorrespondencia" />
              </div>
              <div class="field">
                <label><span class="small">Logradouro</span></label>
                <input data-bind="evento.anfitriao.endCorrespondencia.logradouro" type="text" />
              </div>
            </div>

            <div class="threecol">
              <div class="field">
                <label><span class="small">Número</span></label>
                <input data-bind="evento.anfitriao.endCorrespondencia.numero" type="text" />
              </div>
              <div class="field">
                <label><span class="small">Bairro</span></label>
                <input data-bind="evento.anfitriao.endCorrespondencia.bairro" type="text" />
              </div>
              <div class="field">
                <label><span class="small">Cidade</span></label>
                <input data-bind="evento.anfitriao.endCorrespondencia.cidade" type="text" />
              </div>
            </div>

            <div class="twocol">
              <div class="field">
                <label><span class="small">UF</span></label>
                <input data-bind="evento.anfitriao.endCorrespondencia.uf" type="text" maxlength="2" />
              </div>
              <div class="field">
                <label><span class="small">Complemento</span></label>
                <input data-bind="evento.anfitriao.endCorrespondencia.complemento" type="text" />
              </div>
            </div>

            <div><strong class="small">Endereço para entrega de presentes</strong></div>

            <div class="twocol">
              <div class="field">
                <label><span class="small">CEP</span></label>
                <input data-bind="evento.anfitriao.endEntrega.cep" type="text" inputmode="numeric" maxlength="9" data-cep="evento.anfitriao.endEntrega" />
              </div>
              <div class="field">
                <label><span class="small">Logradouro</span></label>
                <input data-bind="evento.anfitriao.endEntrega.logradouro" type="text" />
              </div>
            </div>

            <div class="threecol">
              <div class="field">
                <label><span class="small">Número</span></label>
                <input data-bind="evento.anfitriao.endEntrega.numero" type="text" />
              </div>
              <div class="field">
                <label><span class="small">Bairro</span></label>
                <input data-bind="evento.anfitriao.endEntrega.bairro" type="text" />
              </div>
              <div class="field">
                <label><span class="small">Cidade</span></label>
                <input data-bind="evento.anfitriao.endEntrega.cidade" type="text" />
              </div>
            </div>

            <div class="twocol">
              <div class="field">
                <label><span class="small">UF</span></label>
                <input data-bind="evento.anfitriao.endEntrega.uf" type="text" maxlength="2" />
              </div>
              <div class="field">
                <label><span class="small">Complemento</span></label>
                <input data-bind="evento.anfitriao.endEntrega.complemento" type="text" />
              </div>
            </div>

            <div class="close-hint">Pressione <strong>Esc</strong> ou clique no lápis novamente para fechar.</div>
          </div>
        </details>

        <details id="secCerimonial"><summary>Cerimonialista</summary>
          <div class="details-wrap">
            <div class="twocol">
              <div class="field">
                <label><span class="small">Nome</span></label>
                <input data-bind="cerimonialista.nomeCompleto" type="text" />
              </div>
              <div class="field">
                <label><span class="small">Telefone</span></label>
                <input data-bind="cerimonialista.telefone" type="text" />
              </div>
            </div>

            <div class="field">
              <label><span class="small">Rede social</span></label>
              <input data-bind="cerimonialista.redeSocial" type="text" />
            </div>

            <div class="close-hint">Pressione <strong>Esc</strong> ou clique no lápis novamente para fechar.</div>
          </div>
        </details>
      </section>

      <!-- ===================== INDICADORES (v2, unificados) ===================== -->
      <section class="card" id="cardIndicadores">
        <h2>Indicadores do evento</h2>
        <div class="mini-grid">
          <!-- ===== 1) Tarefas (Checklist unificado) ===== -->
          <div class="mini kpi" id="kpi_tasks">
            <div class="label"><h3 class="title" id="kpi_task_title">Tarefas</h3></div>
            <div class="actions"><button class="edit-btn" data-open="#secTarefas" aria-label="Editar tarefas" title="Abrir painel de tarefas">✎</button></div>
            <div class="progress progress--lg"><div class="progress__track"><div id="kpi_task_bar" class="progress__bar" style="width:0%"></div></div></div>
            <div class="hbar-legend"><span id="kpi_task_lbl1">0 concluídas — 0%</span><span id="kpi_task_lbl2">Total: 0</span></div>
          </div>

          <!-- ===== 2) Fornecedores ===== -->
          <div class="mini kpi" id="kpi_for">
            <div class="label"><h3 class="title" id="kpi_for_title">Fornecedores</h3></div>
            <div class="actions"><button class="edit-btn" data-open="#secFornecedores" aria-label="Editar fornecedores" title="Abrir painel de fornecedores">✎</button></div>
            <div class="progress progress--lg"><div class="progress__track"><div id="kpi_for_bar" class="progress__bar" style="width:0%"></div></div></div>
            <div class="hbar-legend"><span id="kpi_for_lbl1">R$ 0,00 pagos — 0%</span><span id="kpi_for_lbl2">Total: R$ 0,00</span></div>
          </div>

          <!-- ===== 3) Convidados & Convites ===== -->
          <div class="mini kpi" id="kpi_guests">
            <div class="label"><h3 class="title" id="kpi_guest_title">Convidados &amp; Convites</h3></div>
            <div class="actions"><button class="edit-btn" data-open="#secConvidados" aria-label="Editar convidados" title="Abrir painel de convidados">✎</button></div>
            <div class="progress progress--lg"><div class="progress__track"><div id="kpi_guest_bar" class="progress__bar" style="width:0%"></div></div></div>
            <div class="hbar-legend"><span id="kpi_guest_lbl1">0 confirmados — 0%</span><span id="kpi_guest_lbl2">Total: 0</span></div>
            <div class="progress progress--lg progress--segments" aria-label="Distribuição por mesas/grupos"><div class="progress__track" id="kpi_guest_bands"></div></div>
            <div class="small muted" id="kpi_guest_legend"></div>
          </div>

          <!-- (Removido o KPI de Sincronização — agora no topo) -->
        </div>

        <!-- ===== MiniApp Tarefas ===== -->
        <details id="secTarefas"><summary>Tarefas</summary>
          <div class="details-wrap"><div id="tasks_host"></div><div class="close-hint">Pressione <strong>Esc</strong> ou clique no lápis novamente para fechar.</div></div>
        </details>

        <!-- ===== MiniApp Fornecedores ===== -->
        <details id="secFornecedores"><summary>Fornecedores</summary>
          <div class="details-wrap"><div id="fornecedores_host"></div><div class="close-hint">Pressione <strong>Esc</strong> ou clique no lápis novamente para fechar.</div></div>
        </details>

        <!-- ===== MiniApp Convidados & Convites ===== -->
        <details id="secConvidados"><summary>Convidados & Convites</summary>
          <div class="details-wrap"><div id="convidados_host"></div><div class="close-hint">Pressione <strong>Esc</strong> ou clique no lápis novamente para fechar.</div></div>
        </details>

        <!-- ===== MiniApp Sincronização ===== -->
        <details id="secSync"><summary>Sincronização</summary>
          <div class="details-wrap"><div id="sync_host"></div><div class="close-hint">Pressione <strong>Esc</strong> ou clique no lápis novamente para fechar.</div></div>
        </details>

      </section>
    </div>
  </main>
  <script type="module" src="/src/main.ts"></script>

</body>
</html>
