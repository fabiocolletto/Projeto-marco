<!--
  Template interno do SvelteKit. Pode ser copiado para um widget HTML do Elementor.
  Quando executado fora do bundle local (/bundle/app-host.js), o script de fallback
  injeta automaticamente os artefatos publicados no CDN (widgets/app-base/latest/).
-->
<!doctype html>
<html lang="pt-br">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    %sveltekit.head%
    <link rel="stylesheet" href="/bundle/app-base.css" data-app-base="local" />
    <script type="module" src="/bundle/app-host.js" defer data-app-base="local"></script>
    <script>
      window.addEventListener('sveltekit:start', () => {
        document.querySelector('[data-app-base-fallback]')?.remove();
      });
    </script>
  </head>
  <body class="app-base-body" data-sveltekit-preload-data="hover">
    <div class="app-base-root">
      %sveltekit.body%
      <div
        class="app-base-layout grid min-h-screen grid-rows-[auto,1fr] bg-surface-muted text-ink"
        data-app-base-fallback
      >
        <header class="app-base-layout__top border-b border-surface-muted bg-surface px-6 py-4 shadow-sm">
          <div class="app-base-topbar flex items-center justify-between gap-4">
            <div class="app-base-topbar__branding">
              <p class="app-base-topbar__subtitle">Hub institucional</p>
              <h1 class="app-base-topbar__title">Gestão de eventos</h1>
            </div>
            <div class="app-base-topbar__actions flex items-center gap-3">
              <a class="app-base-topbar__link" href="https://marco.app/ajuda">Central de ajuda</a>
              <button class="app-base-topbar__cta" type="button">Abrir painel</button>
            </div>
          </div>
        </header>
        <div class="app-base-layout__canvas flex min-h-0 flex-1 overflow-hidden">
          <nav class="app-base-layout__nav w-72 shrink-0 border-r border-surface-muted bg-surface px-4 py-6">
            <h2 class="app-base-nav__heading text-sm font-semibold uppercase tracking-wide text-ink-muted">
              Verticais
            </h2>
            <ul class="app-host__nav mt-4 space-y-2" data-app-nav>
              <li>
                <button class="active" data-app="overview" type="button">
                  <span class="icon" aria-hidden="true">📊</span>
                  <span class="label">Visão geral</span>
                </button>
              </li>
              <li>
                <button data-app="evento" type="button">
                  <span class="icon" aria-hidden="true">🎉</span>
                  <span class="label">Evento</span>
                </button>
              </li>
              <li>
                <button data-app="anfitriao" type="button">
                  <span class="icon" aria-hidden="true">🤝</span>
                  <span class="label">Anfitrião</span>
                </button>
              </li>
              <li>
                <button data-app="cerimonial" type="button">
                  <span class="icon" aria-hidden="true">📝</span>
                  <span class="label">Cerimonial</span>
                </button>
              </li>
              <li>
                <button data-app="tarefas" type="button">
                  <span class="icon" aria-hidden="true">✅</span>
                  <span class="label">Tarefas</span>
                </button>
              </li>
              <li>
                <button data-app="fornecedores" type="button">
                  <span class="icon" aria-hidden="true">🏷️</span>
                  <span class="label">Fornecedores</span>
                </button>
              </li>
              <li>
                <button data-app="convidados" type="button">
                  <span class="icon" aria-hidden="true">💌</span>
                  <span class="label">Convidados</span>
                </button>
              </li>
              <li>
                <button data-app="mensagens" type="button">
                  <span class="icon" aria-hidden="true">💬</span>
                  <span class="label">Mensagens</span>
                </button>
              </li>
              <li>
                <button data-app="sync" type="button">
                  <span class="icon" aria-hidden="true">☁️</span>
                  <span class="label">Sincronização</span>
                </button>
              </li>
            </ul>
          </nav>
          <main class="app-base-layout__workspace flex-1 overflow-hidden bg-surface px-6 py-6">
            <div class="app-base-layout__app h-full overflow-auto">
              <div id="app-host" class="app-host__canvas" data-state="marco-0"></div>
            </div>
          </main>
        </div>
      </div>
    </div>
    <script>
      (() => {
        const CDN_BASE = 'https://cdn.5horas.app/widgets/app-base/latest/';
        let fallbackTriggered = false;

        if (typeof window !== 'undefined' && window.__APP_BASE_WIDGET_READY__ === undefined) {
          window.__APP_BASE_WIDGET_READY__ = false;
        }

        const ensureStylesheet = () => {
          if (document.querySelector('link[data-app-base="cdn-style"]')) {
            return;
          }

          const link = document.createElement('link');
          link.rel = 'stylesheet';
          link.href = `${CDN_BASE}app-base-widget.css`;
          link.dataset.appBase = 'cdn-style';
          document.head.appendChild(link);
        };

        const ensureScript = () => {
          if (document.querySelector('script[data-app-base="cdn-script"]')) {
            return;
          }

          const script = document.createElement('script');
          script.type = 'module';
          script.src = `${CDN_BASE}app-base-widget.js`;
          script.dataset.appBase = 'cdn-script';
          document.head.appendChild(script);
        };

        const triggerFallback = () => {
          if (fallbackTriggered) {
            return;
          }

          fallbackTriggered = true;
          ensureStylesheet();
          ensureScript();
        };

        const localScript = document.querySelector('script[data-app-base="local"]');
        const localStylesheet = document.querySelector('link[data-app-base="local"]');

        if (localScript) {
          localScript.addEventListener('error', () => {
            triggerFallback();
          });
        } else {
          triggerFallback();
        }

        if (localStylesheet) {
          localStylesheet.addEventListener('error', () => {
            triggerFallback();
          });
        }

        window.addEventListener('app-base:ready', () => {
          window.__APP_BASE_WIDGET_READY__ = true;
        });

        window.addEventListener('load', () => {
          setTimeout(() => {
            if (!window.__APP_BASE_WIDGET_READY__) {
              triggerFallback();
            }
          }, 1200);
        });
      })();
    </script>
  </body>
</html>
