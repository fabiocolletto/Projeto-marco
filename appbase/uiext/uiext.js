"use strict";(function(){const HEADER_SELECTOR='.ac-appbar__actions';const ACTION_ATTR='data-action-id';const ACTION_CLASS='ac-header-action';function qs(sel){return document.querySelector(sel);}function createIcon(action){const icon=document.createElement('i');icon.className=['ac-i',action.iconRef||''].filter(Boolean).join(' ');icon.setAttribute('aria-hidden','true');if(!icon.textContent){icon.textContent='🌐';}return icon;}function createLabel(action){const span=document.createElement('span');span.className='ac-visually-hidden';span.setAttribute('data-i18n',action.tooltipKey||'');span.textContent='Idioma';return span;}function updateButtonLabels(btn){const label=btn?.querySelector('[data-i18n]');if(label){const text=label.textContent.trim();if(text){btn.setAttribute('aria-label',text);btn.setAttribute('title',text);}}}function addHeaderAction(action){if(!action||!action.id) return;const container=qs(HEADER_SELECTOR);if(!container) return;if(container.querySelector(`[${ACTION_ATTR}="${action.id}"]`)) return;const btn=document.createElement('button');btn.type='button';btn.className=ACTION_CLASS;btn.setAttribute(ACTION_ATTR,action.id);btn.appendChild(createIcon(action));btn.appendChild(createLabel(action));btn.addEventListener('click',()=>{window.dispatchEvent(new CustomEvent('app:header:action:click',{detail:{id:action.id}}));});container.appendChild(btn);updateButtonLabels(btn);}async function loadCatalog(){try{const res=await fetch('../catalog/ui-extensions.json?ts='+Date.now(),{cache:'no-store'});return await res.json();}catch(e){console.warn('[uiext] catalog load failed',e);return {header:[],footer:[]};}}function bindLocaleLabelUpdates(){window.addEventListener('app:i18n:locale_changed',()=>{document.querySelectorAll(`.${ACTION_CLASS}`).forEach(updateButtonLabels);});}async function init(){const catalog=await loadCatalog();(catalog.header||[]).filter(entry=>entry.id==='app.locale').forEach(addHeaderAction);bindLocaleLabelUpdates();}if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',init);}else{init();}})();
