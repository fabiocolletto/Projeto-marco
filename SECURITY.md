# Security Guidelines

## Production secrets
- `HMAC_SHARED_SECRET`: Shared secret used to sign webhook payloads. Store it as the `MAKE_WEBHOOK_SECRET` GitHub secret so workflows can load it without renaming.
- `MAKE_WEBHOOK_URL`: HTTPS endpoint generated by Make. Rotate immediately if exposed.
- `MAKE_API_KEY`: API key required by Make to accept webhook requests. Scope it to the scenario that receives GitHub dispatches.

All three secrets must be defined in the **`prod`** environment so that `.github/workflows/reusable-post-make.yml` can read them during the `post-make` job. Missing values will stop the workflow before any outbound network call.

## Environment approvals
The reusable workflow runs in the `prod` environment, which enforces the environment protection rules configured in GitHub. Each dispatch must be approved by an authorized reviewer before any secret is exposed or any call is sent to Make.

## Logging and secret hygiene
- Never print secret values in workflow logs. The workflow already masks the timestamp, nonce, canonical body, API key, and webhook URL.
- When debugging locally, prefer short-lived secrets and delete temporary files that contain signed payloads. The helper scripts inside `scripts/` create files in `mktemp` locations; remove them immediately after use.
- Rotate secrets if you suspect they leaked into logs, comments, or support channels. Document the rotation in the team runbook.

## Webhook headers
All outbound requests to Make must include the following headers generated by the workflow:
- `X-Signature`: Hex-encoded HMAC signature created with `HMAC_SHARED_SECRET`.
- `X-Timestamp`: Unix timestamp (`ts`) used in the canonical payload.
- `X-Nonce`: Lowercase UUID guaranteeing uniqueness per request.
- `x-make-apikey`: API key expected by Make for authentication.

Consumers that integrate directly with Make must reproduce the same header contract to remain compatible with the automation.
